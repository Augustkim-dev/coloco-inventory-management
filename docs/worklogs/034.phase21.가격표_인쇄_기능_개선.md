# 034. Phase 21: ê°€ê²©í‘œ ë³´ê¸° í˜ì´ì§€ UI ê°œì„  ë° ì¸ì‡„ ê¸°ëŠ¥

## ì‘ì—… ì¼ì
2024-12-17

## ì‘ì—… ë‚´ìš©

### ê°œìš”
1. ê°€ê²©í‘œ ë³´ê¸° í˜ì´ì§€ì˜ íƒ­ UIë¥¼ 2ë‹¨ê³„ êµ¬ì¡°ë¡œ ê°œì„ 
2. ì‚¬ì´ë“œë°”ì— ìƒˆë¡œìš´ Price List ë©”ë‰´ ì¶”ê°€
3. ì¸ì‡„ ì‹œ ë³„ë„ í˜ì´ì§€ì—ì„œ ë‹¤ë‹¨ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì¶œë ¥ë˜ë„ë¡ ê°œì„ 

### ë¬¸ì œì  (ê°œì„  ì „)
- **íƒ­ UI**: ëª¨ë“  ì§€ì (Vietnam, Ho Chi Minh, Korea, Naver...)ì´ í•œ ì¤„ì— í‰ë©´ì ìœ¼ë¡œ ë‚˜ì—´
- **ê³„ì¸µ êµ¬ì¡°**: `â””` ê¸°í˜¸ë¡œ SubBranch í‘œì‹œí•˜ì§€ë§Œ ì‹œê°ì ìœ¼ë¡œ ì•½í•¨
- **ì ‘ê·¼ì„±**: Pricing Configuration ë©”ë‰´ë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **ì¸ì‡„**: `window.print()` í˜¸ì¶œ ì‹œ ìŠ¤í¬ë¡¤ ë°œìƒ, 11pt í°íŠ¸ë¡œ í˜ì´ì§€ ë„˜ì¹¨
- **PDF**: ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì—†ìŒ

### ì£¼ìš” ê¸°ëŠ¥

#### 1. 2ë‹¨ê³„ íƒ­ UI êµ¬ì¡°

**ê°œì„ ëœ UI ì„¤ê³„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ Vietnam (45)    ğŸŒ Korea (75)    ğŸŒ China (0)               â”‚  â† 1ë‹¨ê³„: êµ­ê°€(Branch) íƒ­
â”‚      [ì„ íƒë¨]                                                    â”‚     Badge = í•˜ìœ„ ì§€ì  í•©ê³„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Ho Chi Minh (15)   ğŸ“ Vung Tau (15)   ğŸ“ Hanoi (15)        â”‚  â† 2ë‹¨ê³„: ì§€ì (SubBranch) íƒ­
â”‚                           [ì„ íƒë¨]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒí˜¸ì‘ìš©:**
- í˜ì´ì§€ ì§„ì… ì‹œ â†’ ì²« ë²ˆì§¸ êµ­ê°€ì˜ ì²« ë²ˆì§¸ ì§€ì  ìë™ ì„ íƒ
- êµ­ê°€ íƒ­ í´ë¦­ ì‹œ â†’ í•´ë‹¹ êµ­ê°€ì˜ ì²« ë²ˆì§¸ ì§€ì ìœ¼ë¡œ ìë™ ì „í™˜
- ì§€ì  íƒ­ í´ë¦­ ì‹œ â†’ í•´ë‹¹ ì§€ì ì˜ ê°€ê²©í‘œ í‘œì‹œ

**ì„ íƒ ìƒíƒœ ìƒ‰ìƒ:**
- 2ë‹¨ê³„ íƒ­ ì„ íƒ ì‹œ: ë°°ê²½ìƒ‰ `#DAE3F3`, ê¸€ììƒ‰ `#2F5597`

#### 2. ìƒˆë¡œìš´ Price List ë©”ë‰´

ì‚¬ì´ë“œë°”ì— ë…ë¦½ ë©”ë‰´ë¡œ ì¶”ê°€í•˜ì—¬ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥:
- ê²½ë¡œ: `/price-list`
- ê¶Œí•œ: HQ_Admin, Branch_Manager
- ë‹¤êµ­ì–´: EN "Price List", KO "ê°€ê²©í‘œ ë³´ê¸°", VI "Báº£ng giÃ¡", ZH "ä»·æ ¼è¡¨"

#### 3. ì¸ì‡„ ê¸°ëŠ¥

- **ë³„ë„ ì¸ì‡„ í˜ì´ì§€**: `/print/pricing?locationId=xxx` ê²½ë¡œë¡œ ìƒˆ ì°½ì—ì„œ ì—´ë¦¼
- **ìë™ ë ˆì´ì•„ì›ƒ**: ë°ì´í„° ì–‘ì— ë”°ë¼ í°íŠ¸/ë‹¨ ìˆ˜ ìë™ ì¡°ì ˆ (2ë‹¨/3ë‹¨, 7~9pt)
- **PDF ë‹¤ìš´ë¡œë“œ**: ì¸ì‡„ í˜ì´ì§€ì—ì„œ html2pdf.jsë¡œ PDF ì €ì¥
- **ë²„íŠ¼ êµ¬ì„±**: Price List í˜ì´ì§€ì—ì„œ [ì¸ì‡„/PDF] + [ì—‘ì…€ ë‹¤ìš´ë¡œë“œ]

## ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼

### ìƒˆ íŒŒì¼
| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `app/(dashboard)/price-list/page.tsx` | ìƒˆë¡œìš´ Price List í˜ì´ì§€ (ì‚¬ì´ë“œë°” ë©”ë‰´) |
| `app/(dashboard)/pricing/list/page.tsx` | Pricing Config ë‚´ ê°€ê²©í‘œ ë³´ê¸° í˜ì´ì§€ |
| `app/print/pricing/page.tsx` | ì¸ì‡„ ì „ìš© í˜ì´ì§€ (ì„œë²„ ì»´í¬ë„ŒíŠ¸) |
| `app/print/layout.tsx` | ì¸ì‡„ ì „ìš© ë ˆì´ì•„ì›ƒ (ì‚¬ì´ë“œë°”/í—¤ë” ì—†ìŒ) |
| `components/pricing/price-list-view/price-list-tabs.tsx` | 2ë‹¨ê³„ íƒ­ UI ì»´í¬ë„ŒíŠ¸ |
| `components/pricing/price-list-view/price-list-table.tsx` | ê°€ê²©í‘œ í…Œì´ë¸” ì»´í¬ë„ŒíŠ¸ |
| `components/pricing/price-list-view/price-list-export.tsx` | ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ |
| `components/pricing/price-list-view/print-view.tsx` | ì¸ì‡„ ë·° ì»´í¬ë„ŒíŠ¸ |
| `lib/excel-export.ts` | ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ìœ í‹¸ë¦¬í‹° |

### ìˆ˜ì •ëœ íŒŒì¼
| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `lib/constants.ts` | Price List ë©”ë‰´ í•­ëª© ì¶”ê°€ |
| `components/layout/sidebar.tsx` | navTitleMapì— '/price-list' ë§¤í•‘ ì¶”ê°€ |
| `locales/en/navigation.json` | "priceList": "Price List" ì¶”ê°€ |
| `locales/ko/navigation.json` | "priceList": "ê°€ê²©í‘œ ë³´ê¸°" ì¶”ê°€ |
| `locales/vi/navigation.json` | "priceList": "Báº£ng giÃ¡" ì¶”ê°€ |
| `locales/zh/navigation.json` | "priceList": "ä»·æ ¼è¡¨" ì¶”ê°€ |
| `app/globals.css` | ë‹¤ë‹¨ ë ˆì´ì•„ì›ƒ ë° ì¸ì‡„ ìŠ¤íƒ€ì¼ ì¶”ê°€ |
| `lib/utils.ts` | formatCurrencyì— non-breaking space ì¶”ê°€ |

### íŒ¨í‚¤ì§€ ì¶”ê°€
- `html2pdf.js` - PDF ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
- `xlsx` - ì—‘ì…€ íŒŒì¼ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬

## ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### 2ë‹¨ê³„ íƒ­ êµ¬ì¡° (LocationGroup)

```typescript
interface LocationGroup {
  branch: Location           // êµ­ê°€ (Branch)
  subBranches: Location[]    // ì§€ì /ì±„ë„ (SubBranch)
  totalConfigCount: number   // í•˜ìœ„ ì§€ì  ê°€ê²© ì„¤ì • í•©ê³„
}

// ê·¸ë£¹í•‘ ë¡œì§
const groupedLocations = useMemo((): LocationGroup[] => {
  const branches = sortedLocations
    .filter(loc => loc.location_type === 'Branch')
    .sort((a, b) => a.display_order - b.display_order)  // display_order ì •ë ¬
  return branches.map(branch => {
    const subBranches = sortedLocations.filter(loc => loc.parent_id === branch.id)
    const totalConfigCount = subBranches.reduce((sum, sub) => {
      return sum + pricingConfigs.filter(c => getToLocation(c)?.id === sub.id).length
    }, 0)
    return { branch, subBranches, totalConfigCount }
  })
}, [sortedLocations, pricingConfigs])
```

### ìë™ ë ˆì´ì•„ì›ƒ ê³„ì‚° (ì¸ì‡„)
```typescript
function getLayoutConfig(itemCount: number) {
  if (itemCount <= 20) return { fontSize: 'print-font-9pt', columns: 'print-columns-2' }
  if (itemCount <= 40) return { fontSize: 'print-font-8pt', columns: 'print-columns-2' }
  if (itemCount <= 60) return { fontSize: 'print-font-8pt', columns: 'print-columns-3' }
  return { fontSize: 'print-font-7pt', columns: 'print-columns-3' }
}
```

### PDF ìƒì„±
```typescript
const html2pdf = (await import('html2pdf.js')).default

const opt = {
  margin: 10,
  filename: `PriceList_${locationName}_${date}.pdf`,
  image: { type: 'jpeg', quality: 0.98 },
  html2canvas: { scale: 2, useCORS: true },
  jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
}

html2pdf().set(opt).from(contentRef.current).save()
```

### CSS ë‹¤ë‹¨ ë ˆì´ì•„ì›ƒ
```css
.print-columns-2 { column-count: 2; }
.print-columns-3 { column-count: 3; }

.print-table-compact {
  break-inside: avoid-column;
  font-size: 8pt;
}
```

## ë°ì´í„° íë¦„

### ê°€ê²©í‘œ ë³´ê¸° í˜ì´ì§€
```
[ì‚¬ì´ë“œë°” Price List í´ë¦­]
      â†“
[PriceListPage ì„œë²„ ì»´í¬ë„ŒíŠ¸]
  â”œâ”€ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
  â”œâ”€ ì ‘ê·¼ ê°€ëŠ¥í•œ locations í•„í„°ë§
  â””â”€ ëª¨ë“  pricing_configs ì¡°íšŒ
      â†“
[PriceListTabs í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸]
  â”œâ”€ Branchë³„ ê·¸ë£¹í•‘ (LocationGroup[])
  â”œâ”€ 1ë‹¨ê³„ íƒ­: êµ­ê°€(Branch) ì„ íƒ
  â”œâ”€ 2ë‹¨ê³„ íƒ­: ì§€ì (SubBranch) ì„ íƒ
  â””â”€ ì„ íƒëœ ì§€ì ì˜ ê°€ê²©í‘œ í…Œì´ë¸” í‘œì‹œ
```

### ì¸ì‡„/PDF
```
[ì¸ì‡„/PDF ë²„íŠ¼ í´ë¦­]
      â†“
[window.open('/print/pricing?locationId=xxx')]
      â†“
[PrintPage ì„œë²„ ì»´í¬ë„ŒíŠ¸]
  â”œâ”€ locationIdë¡œ pricing_configs ì¡°íšŒ
  â””â”€ parent ê°€ê²© ê³„ì‚°
      â†“
[PrintView í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸]
  â”œâ”€ ë°ì´í„° ì–‘ì— ë”°ë¥¸ ë ˆì´ì•„ì›ƒ ê³„ì‚°
  â””â”€ ì¸ì‡„/PDF/ë‹«ê¸° ë²„íŠ¼
```

## ë ˆì´ì•„ì›ƒ êµ¬ì¡° ë³€ê²½

### ë¬¸ì œì  1 (ì´ˆê¸° êµ¬í˜„)
- ì¸ì‡„ í˜ì´ì§€ê°€ `app/(dashboard)/pricing/list/print/page.tsx`ì— ìœ„ì¹˜
- ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒì„ ìƒì†ë°›ì•„ ì‚¬ì´ë“œë°”ì™€ í—¤ë”ê°€ í•¨ê»˜ í‘œì‹œë¨
- CSSëŠ” ì ìš©ë˜ì—ˆìœ¼ë‚˜ ë¶ˆí•„ìš”í•œ UI ìš”ì†Œê°€ ì¸ì‡„ë¬¼ì— í¬í•¨

### í•´ê²°ì±… 1
- ì¸ì‡„ í˜ì´ì§€ë¥¼ `app/print/pricing/page.tsx`ë¡œ ì´ë™ (ëŒ€ì‹œë³´ë“œ ë¼ìš°íŠ¸ ê·¸ë£¹ ë°–)
- `app/print/layout.tsx`ì— ë³„ë„ ë ˆì´ì•„ì›ƒ ìƒì„± (ì‚¬ì´ë“œë°”/í—¤ë” ì—†ìŒ)
- ê¹”ë”í•œ ì¸ì‡„ ì „ìš© í˜ì´ì§€ êµ¬í˜„

### ë¬¸ì œì  2 (Hydration ì—ëŸ¬)
- `app/print/layout.tsx`ì—ì„œ `<html>`ê³¼ `<body>` íƒœê·¸ë¥¼ ì¤‘ë³µ ë Œë”ë§
- Next.js App Routerì—ì„œëŠ” ë£¨íŠ¸ ë ˆì´ì•„ì›ƒë§Œ ì´ íƒœê·¸ë“¤ì„ ê°€ì ¸ì•¼ í•¨
- ì¤‘ì²©ëœ ë ˆì´ì•„ì›ƒì—ì„œ ì‚¬ìš© ì‹œ Hydration ì—ëŸ¬ ë°œìƒ:
  ```
  Error: Hydration failed because the initial UI does not match what was rendered on the server.
  Warning: In HTML, <html> cannot be a child of <body>.
  Warning: You are mounting a new html component when a previous one has not first unmounted.
  ```

### í•´ê²°ì±… 2
- `app/print/layout.tsx`ì—ì„œ `<html>`ê³¼ `<body>` íƒœê·¸ ì œê±°
- Fragment(`<>{children}</>`)ë§Œ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •

```typescript
// ìˆ˜ì • ì „ (ì—ëŸ¬ ë°œìƒ)
export default function PrintLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ko">
      <body className="bg-white">
        {children}
      </body>
    </html>
  )
}

// ìˆ˜ì • í›„ (ì •ìƒ ë™ì‘)
export default function PrintLayout({ children }: { children: React.ReactNode }) {
  return <>{children}</>
}
```

## í…ŒìŠ¤íŠ¸ ê²°ê³¼
- TypeScript íƒ€ì… ì²´í¬: í†µê³¼
- Next.js ë¹Œë“œ: ì„±ê³µ
- ìƒˆ í˜ì´ì§€ `/print/pricing` ì¶”ê°€ í™•ì¸
- Hydration ì—ëŸ¬ í•´ê²° í™•ì¸

## ì ‘ê·¼ ë°©ë²•

### ë°©ë²• 1: ì‚¬ì´ë“œë°” ë©”ë‰´
1. ì‚¬ì´ë“œë°”ì—ì„œ **Price List** í´ë¦­
2. 1ë‹¨ê³„ íƒ­ì—ì„œ êµ­ê°€(Branch) ì„ íƒ
3. 2ë‹¨ê³„ íƒ­ì—ì„œ ì§€ì (SubBranch) ì„ íƒ
4. [ì¸ì‡„/PDF] ë˜ëŠ” [ì—‘ì…€ ë‹¤ìš´ë¡œë“œ] ë²„íŠ¼ í´ë¦­

### ë°©ë²• 2: Pricing Configuration ë‚´
1. ì‚¬ì´ë“œë°”ì—ì„œ **Pricing Configuration** í´ë¦­
2. ìƒë‹¨ **ê°€ê²©í‘œ ë³´ê¸°** ë²„íŠ¼ í´ë¦­
3. ì´í›„ ë™ì¼

## ê´€ë ¨ ê³„íš ë¬¸ì„œ
- `docs/plans/029.phase21.ê°€ê²©í‘œ_ë³´ê¸°_í˜ì´ì§€_êµ¬í˜„.md`
- `C:\Users\user\.claude\plans\linear-splashing-squirrel.md`
