# Phase 16: Pricing Configuration 삭제 기능 추가

## 작업 일자
2024-12-04

## 작업 개요
`/pricing` 페이지에서 각 pricing config 항목을 삭제할 수 있는 기능 추가

## 요구사항
- 각 pricing config 항목에 삭제 버튼 추가
- 삭제 전 확인 다이얼로그 표시
- 삭제 후 목록 자동 새로고침

---

## 구현 내용

### 1. DELETE API 라우트 생성

**파일**: `app/api/pricing/[id]/route.ts` (신규)

```typescript
// DELETE /api/pricing/[id]
export async function DELETE(
  request: Request,
  { params }: { params: Promise<{ id: string }> }
) {
  // 1. 인증 확인
  // 2. HQ_Admin 권한 확인
  // 3. pricing_configs 테이블에서 해당 ID 삭제
  // 4. /pricing 페이지 캐시 무효화 (revalidatePath)
  // 5. 성공/실패 응답 반환
}
```

**주요 기능:**
- HQ_Admin 전용 (Branch_Manager는 삭제 불가)
- 삭제 후 `revalidatePath('/pricing', 'page')` 호출
- 에러 발생 시 적절한 에러 메시지 반환

### 2. 삭제 확인 다이얼로그 컴포넌트

**파일**: `components/pricing/delete-pricing-dialog.tsx` (신규)

```typescript
interface DeletePricingDialogProps {
  configId: string
  productSku: string
  productName: string
  branchName: string
  isOpen: boolean
  onClose: () => void
}
```

**UI 구성:**
- AlertDialog 컴포넌트 사용 (기존 delete-location-dialog.tsx 패턴 참고)
- 제품 SKU, 이름, 지점명 표시
- "This action cannot be undone" 경고 메시지
- Cancel / Delete 버튼 (Delete는 빨간색)

**동작:**
1. Delete 버튼 클릭
2. `DELETE /api/pricing/{id}` API 호출
3. 성공 시 toast 메시지 표시
4. `router.refresh()` 호출하여 목록 새로고침
5. 다이얼로그 닫기

### 3. pricing-list.tsx 수정

**파일**: `components/pricing/pricing-list.tsx`

**변경사항:**

1. Import 추가:
```typescript
import { useState } from 'react'
import { Trash2 } from 'lucide-react'
import { DeletePricingDialog } from './delete-pricing-dialog'
```

2. 삭제 다이얼로그 state 추가:
```typescript
const [deleteDialog, setDeleteDialog] = useState<{
  isOpen: boolean
  config: PricingConfig | null
}>({ isOpen: false, config: null })
```

3. Actions 컬럼에 삭제 버튼 추가:
```tsx
<Button
  variant="ghost"
  size="sm"
  onClick={() => setDeleteDialog({ isOpen: true, config })}
  className="text-destructive hover:text-destructive hover:bg-destructive/10"
>
  <Trash2 className="h-4 w-4" />
</Button>
```

4. DeletePricingDialog 렌더링:
```tsx
{deleteDialog.config && (
  <DeletePricingDialog
    configId={deleteDialog.config.id}
    productSku={deleteDialog.config.product.sku}
    productName={deleteDialog.config.product.name}
    branchName={deleteDialog.config.to_location.name}
    isOpen={deleteDialog.isOpen}
    onClose={() => setDeleteDialog({ isOpen: false, config: null })}
  />
)}
```

---

## UI 변경

### Before
```
| Product | ... | Actions |
|---------|-----|---------|
| SKU-001 | ... | [Edit]  |
```

### After
```
| Product | ... | Actions        |
|---------|-----|----------------|
| SKU-001 | ... | [Edit] [Delete]|
```

### 삭제 확인 다이얼로그
```
┌─────────────────────────────────────────────┐
│  Delete Pricing Configuration               │
├─────────────────────────────────────────────┤
│  Are you sure you want to delete the        │
│  pricing for "SKU-001" (Product Name)       │
│  at "Vietnam Main Branch"?                  │
│                                             │
│  This action cannot be undone. You will     │
│  need to reconfigure the pricing if you     │
│  want to sell this product at this location.│
├─────────────────────────────────────────────┤
│                    [Cancel] [Delete]        │
└─────────────────────────────────────────────┘
```

---

## 생성된 파일 목록

| 파일 | 설명 |
|------|------|
| `app/api/pricing/[id]/route.ts` | DELETE API 라우트 |
| `components/pricing/delete-pricing-dialog.tsx` | 삭제 확인 다이얼로그 컴포넌트 |

## 수정된 파일 목록

| 파일 | 변경 내용 |
|------|----------|
| `components/pricing/pricing-list.tsx` | 삭제 버튼 및 다이얼로그 추가 |

---

## 권한

| 역할 | 삭제 권한 |
|------|----------|
| HQ_Admin | ✅ 가능 |
| Branch_Manager | ❌ 불가 (403 Forbidden) |

---

## 커밋 내역

| 커밋 | 설명 |
|------|------|
| `bbdf703` | Feat: Pricing Configuration 삭제 기능 추가 |
