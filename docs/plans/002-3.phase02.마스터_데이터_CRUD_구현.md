# 002-3.phase02.마스터 데이터 CRUD 구현

**작업 단계**: Phase 02 - Step 3/3
**예상 소요 시간**: 3-4시간
**담당자**: 개발팀
**목표**: Locations, Suppliers, Products 관리 화면 구현

---

## 1. 개요

마스터 데이터 관리 화면을 구현합니다. 3개의 주요 엔티티(Locations, Suppliers, Products)에 대한 CRUD 기능을 제공하며, HQ Admin만 접근 가능하도록 권한을 제어합니다.

### 핵심 목표
- ✅ Locations 관리 UI (읽기 전용 중심)
- ✅ Suppliers 관리 UI (전체 CRUD)
- ✅ Products 관리 UI (전체 CRUD + 추가 검증)
- ✅ 권한 체크 (HQ Admin만 접근)
- ✅ 폼 유효성 검사 및 에러 핸들링

---

## 2. 구현 우선순위

```
1. Locations (가장 단순, 읽기 위주)
2. Suppliers (기본 CRUD 패턴)
3. Products (가장 복잡, SKU 중복 체크 등)
```

---

## 3. Locations 관리 (지사 정보)

### 3.1 개요
- **특징**: 읽기 전용에 가까움 (초기 3개 지사만 사용)
- **수정 가능 필드**: address, contact_person, phone만
- **수정 불가 필드**: name, location_type, country_code, currency

### 3.2 파일 구조

```
app/(dashboard)/locations/
├── page.tsx                    # 지사 목록 페이지
└── [id]/
    └── edit/
        └── page.tsx            # 지사 수정 페이지 (제한적)

components/locations/
├── locations-list.tsx          # 지사 목록 컴포넌트
└── location-form.tsx           # 지사 수정 폼
```

### 3.3 지사 목록 페이지

**파일**: `app/(dashboard)/locations/page.tsx`

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { LocationsList } from '@/components/locations/locations-list'

export default async function LocationsPage() {
  const supabase = createServerClient()

  // 사용자 권한 확인
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  // HQ Admin만 접근 가능
  if (userData?.role !== 'HQ_Admin') {
    redirect('/dashboard')
  }

  // 지사 목록 조회
  const { data: locations, error } = await supabase
    .from('locations')
    .select('*')
    .order('location_type', { ascending: false }) // HQ 먼저

  if (error) {
    return <div>Error loading locations: {error.message}</div>
  }

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold">Locations</h1>
        <p className="text-gray-500 mt-2">
          Manage headquarters and branch information
        </p>
      </div>

      <LocationsList locations={locations || []} />
    </div>
  )
}
```

### 3.4 지사 목록 컴포넌트

**파일**: `components/locations/locations-list.tsx`

```typescript
'use client'

import { Location } from '@/types'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import Link from 'next/link'
import { Edit } from 'lucide-react'

interface LocationsListProps {
  locations: Location[]
}

export function LocationsList({ locations }: LocationsListProps) {
  return (
    <div className="border rounded-lg">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>Name</TableHead>
            <TableHead>Type</TableHead>
            <TableHead>Country</TableHead>
            <TableHead>Currency</TableHead>
            <TableHead>Contact</TableHead>
            <TableHead className="text-right">Actions</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {locations.map((location) => (
            <TableRow key={location.id}>
              <TableCell className="font-medium">{location.name}</TableCell>
              <TableCell>
                <Badge variant={location.location_type === 'HQ' ? 'default' : 'secondary'}>
                  {location.location_type}
                </Badge>
              </TableCell>
              <TableCell>{location.country_code}</TableCell>
              <TableCell>{location.currency}</TableCell>
              <TableCell>
                {location.contact_person || '-'}
                {location.phone && ` (${location.phone})`}
              </TableCell>
              <TableCell className="text-right">
                <Link href={`/locations/${location.id}/edit`}>
                  <Button variant="ghost" size="sm">
                    <Edit className="h-4 w-4" />
                  </Button>
                </Link>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  )
}
```

### 3.5 지사 수정 폼

**파일**: `components/locations/location-form.tsx`

```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Location } from '@/types'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'

interface LocationFormProps {
  location: Location
}

export function LocationForm({ location }: LocationFormProps) {
  const [formData, setFormData] = useState({
    address: location.address || '',
    contact_person: location.contact_person || '',
    phone: location.phone || '',
  })
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      const { error } = await supabase
        .from('locations')
        .update(formData)
        .eq('id', location.id)

      if (error) throw error

      toast({
        title: 'Success',
        description: 'Location updated successfully',
      })

      router.push('/locations')
      router.refresh()
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Error',
        description: error.message,
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>Edit Location - {location.name}</CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          {/* 읽기 전용 필드 */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label>Name (Read Only)</Label>
              <Input value={location.name} disabled />
            </div>
            <div>
              <Label>Type (Read Only)</Label>
              <Input value={location.location_type} disabled />
            </div>
            <div>
              <Label>Country Code (Read Only)</Label>
              <Input value={location.country_code} disabled />
            </div>
            <div>
              <Label>Currency (Read Only)</Label>
              <Input value={location.currency} disabled />
            </div>
          </div>

          {/* 수정 가능 필드 */}
          <div>
            <Label htmlFor="address">Address</Label>
            <Textarea
              id="address"
              value={formData.address}
              onChange={(e) => setFormData({ ...formData, address: e.target.value })}
              rows={3}
            />
          </div>

          <div>
            <Label htmlFor="contact_person">Contact Person</Label>
            <Input
              id="contact_person"
              value={formData.contact_person}
              onChange={(e) =>
                setFormData({ ...formData, contact_person: e.target.value })
              }
            />
          </div>

          <div>
            <Label htmlFor="phone">Phone</Label>
            <Input
              id="phone"
              value={formData.phone}
              onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
            />
          </div>

          <div className="flex gap-2">
            <Button type="submit" disabled={loading}>
              {loading ? 'Saving...' : 'Save Changes'}
            </Button>
            <Button
              type="button"
              variant="outline"
              onClick={() => router.back()}
            >
              Cancel
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  )
}
```

### 3.6 지사 수정 페이지

**파일**: `app/(dashboard)/locations/[id]/edit/page.tsx`

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { LocationForm } from '@/components/locations/location-form'
import { notFound, redirect } from 'next/navigation'

export default async function EditLocationPage({
  params,
}: {
  params: { id: string }
}) {
  const supabase = createServerClient()

  // 권한 확인
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  if (userData?.role !== 'HQ_Admin') {
    redirect('/dashboard')
  }

  // 지사 정보 조회
  const { data: location, error } = await supabase
    .from('locations')
    .select('*')
    .eq('id', params.id)
    .single()

  if (error || !location) {
    notFound()
  }

  return (
    <div>
      <h1 className="text-3xl font-bold mb-6">Edit Location</h1>
      <LocationForm location={location} />
    </div>
  )
}
```

---

## 4. Suppliers 관리 (공급업체)

### 4.1 개요
- **특징**: 전체 CRUD 기능 제공
- **필수 필드**: name
- **선택 필드**: contact_person, phone, email, address, notes

### 4.2 파일 구조

```
app/(dashboard)/suppliers/
├── page.tsx                    # 공급업체 목록
├── new/
│   └── page.tsx                # 공급업체 추가
└── [id]/
    └── edit/
        └── page.tsx            # 공급업체 수정

components/suppliers/
├── suppliers-list.tsx          # 공급업체 목록
└── supplier-form.tsx           # 공급업체 폼
```

### 4.3 공급업체 목록 페이지

**파일**: `app/(dashboard)/suppliers/page.tsx`

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { SuppliersList } from '@/components/suppliers/suppliers-list'
import { Button } from '@/components/ui/button'
import Link from 'next/link'
import { Plus } from 'lucide-react'

export default async function SuppliersPage() {
  const supabase = createServerClient()

  // 권한 확인
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  if (userData?.role !== 'HQ_Admin') {
    redirect('/dashboard')
  }

  // 공급업체 목록 조회
  const { data: suppliers, error } = await supabase
    .from('suppliers')
    .select('*')
    .order('created_at', { ascending: false })

  if (error) {
    return <div>Error loading suppliers: {error.message}</div>
  }

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold">Suppliers</h1>
          <p className="text-gray-500 mt-2">Manage factory and supplier information</p>
        </div>
        <Link href="/suppliers/new">
          <Button>
            <Plus className="mr-2 h-4 w-4" />
            Add Supplier
          </Button>
        </Link>
      </div>

      <SuppliersList suppliers={suppliers || []} />
    </div>
  )
}
```

### 4.4 공급업체 목록 컴포넌트

**파일**: `components/suppliers/suppliers-list.tsx`

```typescript
'use client'

import { Supplier } from '@/types'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Button } from '@/components/ui/button'
import Link from 'next/link'
import { Edit, Trash } from 'lucide-react'
import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { useToast } from '@/components/ui/use-toast'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'

interface SuppliersListProps {
  suppliers: Supplier[]
}

export function SuppliersList({ suppliers }: SuppliersListProps) {
  const [deleteId, setDeleteId] = useState<string | null>(null)
  const [deleting, setDeleting] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleDelete = async () => {
    if (!deleteId) return

    setDeleting(true)

    try {
      const { error } = await supabase
        .from('suppliers')
        .delete()
        .eq('id', deleteId)

      if (error) throw error

      toast({
        title: 'Success',
        description: 'Supplier deleted successfully',
      })

      setDeleteId(null)
      router.refresh()
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Error',
        description: error.message,
      })
    } finally {
      setDeleting(false)
    }
  }

  return (
    <>
      <div className="border rounded-lg">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Name</TableHead>
              <TableHead>Contact Person</TableHead>
              <TableHead>Phone</TableHead>
              <TableHead>Email</TableHead>
              <TableHead className="text-right">Actions</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {suppliers.length === 0 ? (
              <TableRow>
                <TableCell colSpan={5} className="text-center text-gray-500 py-8">
                  No suppliers found. Add your first supplier to get started.
                </TableCell>
              </TableRow>
            ) : (
              suppliers.map((supplier) => (
                <TableRow key={supplier.id}>
                  <TableCell className="font-medium">{supplier.name}</TableCell>
                  <TableCell>{supplier.contact_person || '-'}</TableCell>
                  <TableCell>{supplier.phone || '-'}</TableCell>
                  <TableCell>{supplier.email || '-'}</TableCell>
                  <TableCell className="text-right">
                    <div className="flex justify-end gap-2">
                      <Link href={`/suppliers/${supplier.id}/edit`}>
                        <Button variant="ghost" size="sm">
                          <Edit className="h-4 w-4" />
                        </Button>
                      </Link>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => setDeleteId(supplier.id)}
                      >
                        <Trash className="h-4 w-4 text-red-500" />
                      </Button>
                    </div>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </div>

      {/* 삭제 확인 다이얼로그 */}
      <Dialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Delete Supplier</DialogTitle>
            <DialogDescription>
              Are you sure you want to delete this supplier? This action cannot be
              undone.
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button variant="outline" onClick={() => setDeleteId(null)}>
              Cancel
            </Button>
            <Button
              variant="destructive"
              onClick={handleDelete}
              disabled={deleting}
            >
              {deleting ? 'Deleting...' : 'Delete'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </>
  )
}
```

### 4.5 공급업체 폼 컴포넌트

**파일**: `components/suppliers/supplier-form.tsx`

```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Supplier } from '@/types'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'

interface SupplierFormProps {
  supplier?: Supplier
  mode: 'create' | 'edit'
}

export function SupplierForm({ supplier, mode }: SupplierFormProps) {
  const [formData, setFormData] = useState({
    name: supplier?.name || '',
    contact_person: supplier?.contact_person || '',
    phone: supplier?.phone || '',
    email: supplier?.email || '',
    address: supplier?.address || '',
    notes: supplier?.notes || '',
  })
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      if (mode === 'create') {
        const { error } = await supabase.from('suppliers').insert([formData])

        if (error) throw error

        toast({
          title: 'Success',
          description: 'Supplier created successfully',
        })
      } else {
        const { error } = await supabase
          .from('suppliers')
          .update(formData)
          .eq('id', supplier!.id)

        if (error) throw error

        toast({
          title: 'Success',
          description: 'Supplier updated successfully',
        })
      }

      router.push('/suppliers')
      router.refresh()
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Error',
        description: error.message,
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>
          {mode === 'create' ? 'Add New Supplier' : 'Edit Supplier'}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <Label htmlFor="name">
              Name <span className="text-red-500">*</span>
            </Label>
            <Input
              id="name"
              value={formData.name}
              onChange={(e) => setFormData({ ...formData, name: e.target.value })}
              required
              placeholder="Enter supplier name"
            />
          </div>

          <div>
            <Label htmlFor="contact_person">Contact Person</Label>
            <Input
              id="contact_person"
              value={formData.contact_person}
              onChange={(e) =>
                setFormData({ ...formData, contact_person: e.target.value })
              }
              placeholder="Enter contact person name"
            />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label htmlFor="phone">Phone</Label>
              <Input
                id="phone"
                value={formData.phone}
                onChange={(e) =>
                  setFormData({ ...formData, phone: e.target.value })
                }
                placeholder="+82-10-1234-5678"
              />
            </div>

            <div>
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={formData.email}
                onChange={(e) =>
                  setFormData({ ...formData, email: e.target.value })
                }
                placeholder="supplier@example.com"
              />
            </div>
          </div>

          <div>
            <Label htmlFor="address">Address</Label>
            <Textarea
              id="address"
              value={formData.address}
              onChange={(e) =>
                setFormData({ ...formData, address: e.target.value })
              }
              rows={3}
              placeholder="Enter supplier address"
            />
          </div>

          <div>
            <Label htmlFor="notes">Notes</Label>
            <Textarea
              id="notes"
              value={formData.notes}
              onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
              rows={4}
              placeholder="Additional notes about the supplier"
            />
          </div>

          <div className="flex gap-2">
            <Button type="submit" disabled={loading}>
              {loading ? 'Saving...' : mode === 'create' ? 'Create' : 'Save Changes'}
            </Button>
            <Button type="button" variant="outline" onClick={() => router.back()}>
              Cancel
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  )
}
```

### 4.6 공급업체 추가/수정 페이지

**파일**: `app/(dashboard)/suppliers/new/page.tsx`

```typescript
import { SupplierForm } from '@/components/suppliers/supplier-form'
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'

export default async function NewSupplierPage() {
  const supabase = createServerClient()

  // 권한 확인
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  if (userData?.role !== 'HQ_Admin') {
    redirect('/dashboard')
  }

  return (
    <div>
      <h1 className="text-3xl font-bold mb-6">Add Supplier</h1>
      <SupplierForm mode="create" />
    </div>
  )
}
```

**파일**: `app/(dashboard)/suppliers/[id]/edit/page.tsx`

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { SupplierForm } from '@/components/suppliers/supplier-form'
import { notFound, redirect } from 'next/navigation'

export default async function EditSupplierPage({
  params,
}: {
  params: { id: string }
}) {
  const supabase = createServerClient()

  // 권한 확인
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  if (userData?.role !== 'HQ_Admin') {
    redirect('/dashboard')
  }

  // 공급업체 정보 조회
  const { data: supplier, error } = await supabase
    .from('suppliers')
    .select('*')
    .eq('id', params.id)
    .single()

  if (error || !supplier) {
    notFound()
  }

  return (
    <div>
      <h1 className="text-3xl font-bold mb-6">Edit Supplier</h1>
      <SupplierForm supplier={supplier} mode="edit" />
    </div>
  )
}
```

---

## 5. Products 관리 (제품)

### 5.1 개요
- **특징**: 전체 CRUD + SKU 중복 체크
- **필수 필드**: sku, name
- **추가 검증**: SKU 유효성, shelf_life_days 양수

### 5.2 파일 구조

```
app/(dashboard)/products/
├── page.tsx                    # 제품 목록
├── new/
│   └── page.tsx                # 제품 추가
└── [id]/
    └── edit/
        └── page.tsx            # 제품 수정

components/products/
├── products-list.tsx           # 제품 목록
└── product-form.tsx            # 제품 폼 (SKU 중복 체크 포함)
```

### 5.3 제품 폼 컴포넌트 (핵심)

**파일**: `components/products/product-form.tsx`

```typescript
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Product } from '@/types'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'
import { PRODUCT_UNITS, PRODUCT_CATEGORIES } from '@/lib/constants'
import { isValidSKU } from '@/lib/utils'

interface ProductFormProps {
  product?: Product
  mode: 'create' | 'edit'
}

export function ProductForm({ product, mode }: ProductFormProps) {
  const [formData, setFormData] = useState({
    sku: product?.sku || '',
    name: product?.name || '',
    name_ko: product?.name_ko || '',
    name_vn: product?.name_vn || '',
    name_cn: product?.name_cn || '',
    category: product?.category || '',
    unit: product?.unit || 'EA',
    shelf_life_days: product?.shelf_life_days || 730,
    description: product?.description || '',
  })
  const [loading, setLoading] = useState(false)
  const [skuError, setSkuError] = useState('')
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  // SKU 중복 체크
  const checkSKU = async (sku: string) => {
    if (!sku || sku === product?.sku) {
      setSkuError('')
      return true
    }

    if (!isValidSKU(sku)) {
      setSkuError('SKU must contain only uppercase letters, numbers, and hyphens')
      return false
    }

    const { data } = await supabase
      .from('products')
      .select('id')
      .eq('sku', sku)
      .maybeSingle()

    if (data) {
      setSkuError('SKU already exists')
      return false
    }

    setSkuError('')
    return true
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    // SKU 검증
    const isValidSKUCheck = await checkSKU(formData.sku)
    if (!isValidSKUCheck) return

    // 유통기한 검증
    if (formData.shelf_life_days <= 0) {
      toast({
        variant: 'destructive',
        title: 'Error',
        description: 'Shelf life must be greater than 0',
      })
      return
    }

    setLoading(true)

    try {
      if (mode === 'create') {
        const { error } = await supabase.from('products').insert([formData])

        if (error) throw error

        toast({
          title: 'Success',
          description: 'Product created successfully',
        })
      } else {
        const { error } = await supabase
          .from('products')
          .update(formData)
          .eq('id', product!.id)

        if (error) throw error

        toast({
          title: 'Success',
          description: 'Product updated successfully',
        })
      }

      router.push('/products')
      router.refresh()
    } catch (error: any) {
      toast({
        variant: 'destructive',
        title: 'Error',
        description: error.message,
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>
          {mode === 'create' ? 'Add New Product' : 'Edit Product'}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          {/* SKU & Name */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label htmlFor="sku">
                SKU <span className="text-red-500">*</span>
              </Label>
              <Input
                id="sku"
                value={formData.sku}
                onChange={(e) => {
                  const value = e.target.value.toUpperCase()
                  setFormData({ ...formData, sku: value })
                }}
                onBlur={(e) => checkSKU(e.target.value)}
                required
                placeholder="PRD-001"
                disabled={mode === 'edit'} // SKU는 수정 불가
              />
              {skuError && (
                <p className="text-sm text-red-500 mt-1">{skuError}</p>
              )}
            </div>

            <div>
              <Label htmlFor="name">
                Name <span className="text-red-500">*</span>
              </Label>
              <Input
                id="name"
                value={formData.name}
                onChange={(e) =>
                  setFormData({ ...formData, name: e.target.value })
                }
                required
                placeholder="Product name"
              />
            </div>
          </div>

          {/* 다국어 이름 (선택) */}
          <div className="grid grid-cols-3 gap-4">
            <div>
              <Label htmlFor="name_ko">Korean Name</Label>
              <Input
                id="name_ko"
                value={formData.name_ko}
                onChange={(e) =>
                  setFormData({ ...formData, name_ko: e.target.value })
                }
                placeholder="제품명"
              />
            </div>
            <div>
              <Label htmlFor="name_vn">Vietnamese Name</Label>
              <Input
                id="name_vn"
                value={formData.name_vn}
                onChange={(e) =>
                  setFormData({ ...formData, name_vn: e.target.value })
                }
                placeholder="Tên sản phẩm"
              />
            </div>
            <div>
              <Label htmlFor="name_cn">Chinese Name</Label>
              <Input
                id="name_cn"
                value={formData.name_cn}
                onChange={(e) =>
                  setFormData({ ...formData, name_cn: e.target.value })
                }
                placeholder="产品名称"
              />
            </div>
          </div>

          {/* Category, Unit, Shelf Life */}
          <div className="grid grid-cols-3 gap-4">
            <div>
              <Label htmlFor="category">Category</Label>
              <Select
                value={formData.category}
                onValueChange={(value) =>
                  setFormData({ ...formData, category: value })
                }
              >
                <SelectTrigger id="category">
                  <SelectValue placeholder="Select category" />
                </SelectTrigger>
                <SelectContent>
                  {PRODUCT_CATEGORIES.map((cat) => (
                    <SelectItem key={cat.value} value={cat.value}>
                      {cat.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label htmlFor="unit">
                Unit <span className="text-red-500">*</span>
              </Label>
              <Select
                value={formData.unit}
                onValueChange={(value) =>
                  setFormData({ ...formData, unit: value })
                }
              >
                <SelectTrigger id="unit">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {PRODUCT_UNITS.map((unit) => (
                    <SelectItem key={unit.value} value={unit.value}>
                      {unit.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label htmlFor="shelf_life_days">
                Shelf Life (days) <span className="text-red-500">*</span>
              </Label>
              <Input
                id="shelf_life_days"
                type="number"
                value={formData.shelf_life_days}
                onChange={(e) =>
                  setFormData({
                    ...formData,
                    shelf_life_days: parseInt(e.target.value) || 0,
                  })
                }
                required
                min="1"
              />
            </div>
          </div>

          {/* Description */}
          <div>
            <Label htmlFor="description">Description</Label>
            <Textarea
              id="description"
              value={formData.description}
              onChange={(e) =>
                setFormData({ ...formData, description: e.target.value })
              }
              rows={4}
              placeholder="Product description"
            />
          </div>

          <div className="flex gap-2">
            <Button type="submit" disabled={loading || !!skuError}>
              {loading ? 'Saving...' : mode === 'create' ? 'Create' : 'Save Changes'}
            </Button>
            <Button type="button" variant="outline" onClick={() => router.back()}>
              Cancel
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  )
}
```

### 5.4 제품 목록 및 페이지

Products의 목록 페이지와 추가/수정 페이지는 Suppliers와 유사한 패턴으로 구현합니다.

**주요 차이점:**
- 제품 목록에 SKU, Category, Unit 표시
- SKU 컬럼 강조 (monospace font)
- Shelf Life 표시 (일수 → 개월로 변환 표시 가능)

---

## 6. 네비게이션 메뉴 업데이트

**파일**: `lib/constants.ts` (기존 파일 수정)

```typescript
import { NavItem } from '@/types'
import {
  LayoutDashboard,
  Package,
  ShoppingCart,
  Users,
  MapPin,
  Settings,
  TrendingUp,
} from 'lucide-react'

export const NAV_ITEMS: NavItem[] = [
  {
    title: 'Dashboard',
    href: '/dashboard',
    icon: LayoutDashboard,
    roles: ['HQ_Admin', 'Branch_Manager'],
  },
  {
    title: 'Locations', // 추가
    href: '/locations',
    icon: MapPin,
    roles: ['HQ_Admin'],
  },
  {
    title: 'Suppliers',
    href: '/suppliers',
    icon: Users,
    roles: ['HQ_Admin'],
  },
  {
    title: 'Products',
    href: '/products',
    icon: Package,
    roles: ['HQ_Admin'],
  },
  {
    title: 'Purchase Orders',
    href: '/purchase-orders',
    icon: ShoppingCart,
    roles: ['HQ_Admin'],
  },
  {
    title: 'Inventory',
    href: '/inventory',
    icon: Package,
    roles: ['HQ_Admin', 'Branch_Manager'],
  },
  {
    title: 'Sales',
    href: '/sales',
    icon: TrendingUp,
    roles: ['HQ_Admin', 'Branch_Manager'],
  },
  {
    title: 'Settings',
    href: '/settings',
    icon: Settings,
    roles: ['HQ_Admin'],
  },
]
```

---

## 7. 완료 체크리스트

### Locations
- [ ] `app/(dashboard)/locations/page.tsx` 생성
- [ ] `app/(dashboard)/locations/[id]/edit/page.tsx` 생성
- [ ] `components/locations/locations-list.tsx` 생성
- [ ] `components/locations/location-form.tsx` 생성
- [ ] HQ Admin만 접근 확인
- [ ] 연락처 정보 수정 테스트

### Suppliers
- [ ] `app/(dashboard)/suppliers/page.tsx` 생성
- [ ] `app/(dashboard)/suppliers/new/page.tsx` 생성
- [ ] `app/(dashboard)/suppliers/[id]/edit/page.tsx` 생성
- [ ] `components/suppliers/suppliers-list.tsx` 생성
- [ ] `components/suppliers/supplier-form.tsx` 생성
- [ ] CRUD 기능 테스트 (추가/수정/삭제/조회)
- [ ] 삭제 확인 다이얼로그 테스트

### Products
- [ ] `app/(dashboard)/products/page.tsx` 생성
- [ ] `app/(dashboard)/products/new/page.tsx` 생성
- [ ] `app/(dashboard)/products/[id]/edit/page.tsx` 생성
- [ ] `components/products/products-list.tsx` 생성
- [ ] `components/products/product-form.tsx` 생성
- [ ] SKU 중복 체크 기능 테스트
- [ ] SKU 유효성 검사 테스트
- [ ] Shelf life 양수 검증 테스트
- [ ] Unit/Category 선택 기능 테스트

### 공통
- [ ] 네비게이션 메뉴에 Locations, Suppliers, Products 추가
- [ ] HQ Admin 권한 체크 확인
- [ ] Branch Manager 접근 차단 확인
- [ ] Toast 알림 정상 작동 확인
- [ ] 빈 목록 UI 표시 확인
- [ ] 폼 유효성 검사 확인

---

## 8. 테스트 시나리오

### 8.1 Locations
1. HQ Admin으로 로그인
2. Locations 메뉴 클릭
3. 3개 지사 목록 표시 확인
4. Vietnam Branch 수정 클릭
5. Address, Contact Person, Phone 수정
6. 저장 후 목록에서 변경 확인

### 8.2 Suppliers
1. HQ Admin으로 로그인
2. Suppliers 메뉴 클릭
3. "Add Supplier" 버튼 클릭
4. 모든 필드 입력 후 생성
5. 목록에서 방금 생성한 공급업체 확인
6. 수정 버튼 클릭하여 정보 수정
7. 삭제 버튼 클릭하여 확인 다이얼로그 테스트

### 8.3 Products
1. HQ Admin으로 로그인
2. Products 메뉴 클릭
3. "Add Product" 버튼 클릭
4. SKU에 "test-001" 입력 (소문자) → 자동 대문자 변환 확인
5. 필수 필드 입력 후 생성
6. 같은 SKU로 다시 생성 시도 → 중복 오류 확인
7. 유효하지 않은 SKU 입력 → 오류 메시지 확인
8. Shelf Life에 0 입력 → 오류 확인
9. 정상 데이터로 제품 생성 완료

### 8.4 권한 테스트
1. Branch Manager 계정으로 로그인
2. 브라우저 주소창에 `/suppliers` 직접 입력
3. `/dashboard`로 리다이렉트 확인

---

## 9. 다음 단계

Step 3 완료 후:
1. Git 커밋
2. Worklog 작성 (`002.phase02.데이터베이스_스키마_및_마스터_데이터.md`)
3. GitHub 푸시

---

**작성자**: Claude Code
**작성일**: 2025-10-28
**다음 Phase**: Phase 03 (구매 발주 및 HQ 입고 처리)
