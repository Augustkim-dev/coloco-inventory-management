# Phase 08: 대시보드, 리포트, 배포

**작업 기간**: 1주 (5일)
**담당자**: 개발팀
**목표**: 대시보드 구현, 기본 리포트, CI/CD 설정, Vercel 배포

---

## 1. 개요

프로젝트의 마지막 단계로, 대시보드와 기본 리포트를 구현하고, GitHub Actions CI/CD를 설정하여 Vercel에 배포합니다.

### 핵심 목표
- ✅ 대시보드 구현 (오늘 판매액, 재고 가치, 유통기한 경고)
- ✅ 기본 리포트 (일별 판매, 재고 현황, 거래 이력)
- ✅ GitHub Actions CI/CD 설정
- ✅ Vercel 배포
- ✅ 최종 통합 테스트
- ✅ 사용자 매뉴얼 작성

---

## 2. 작업 상세

### 2.1 대시보드 구현

#### 2.1.1 대시보드 페이지

**파일**: `app/(dashboard)/dashboard/page.tsx`

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { DashboardStats } from '@/components/dashboard/dashboard-stats'
import { ExpiryWarnings } from '@/components/dashboard/expiry-warnings'
import { RecentSales } from '@/components/dashboard/recent-sales'

export default async function DashboardPage() {
  const supabase = createServerClient()

  // 현재 사용자 정보 조회
  const { data: { user } } = await supabase.auth.getUser()
  const { data: profile } = await supabase
    .from('users')
    .select('role, location_id')
    .eq('id', user?.id)
    .single()

  // 오늘 판매액 조회
  const today = new Date().toISOString().split('T')[0]
  let salesQuery = supabase
    .from('sales')
    .select('total_amount, currency')
    .eq('sale_date', today)

  if (profile?.role === 'Branch_Manager') {
    salesQuery = salesQuery.eq('location_id', profile.location_id)
  }

  const { data: todaySales } = await salesQuery

  // 재고 가치 조회
  let stockQuery = supabase
    .from('stock_batches')
    .select(`
      qty_on_hand,
      unit_cost,
      location:locations(name, currency)
    `)
    .eq('quality_status', 'OK')
    .gt('qty_on_hand', 0)

  if (profile?.role === 'Branch_Manager') {
    stockQuery = stockQuery.eq('location_id', profile.location_id)
  }

  const { data: stockBatches } = await stockQuery

  // 유통기한 경고 조회 (3개월 이내)
  const threeMonthsLater = new Date()
  threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3)

  let expiryQuery = supabase
    .from('stock_batches')
    .select(`
      *,
      product:products(sku, name, unit),
      location:locations(name)
    `)
    .eq('quality_status', 'OK')
    .gt('qty_on_hand', 0)
    .lte('expiry_date', threeMonthsLater.toISOString().split('T')[0])
    .order('expiry_date', { ascending: true })

  if (profile?.role === 'Branch_Manager') {
    expiryQuery = expiryQuery.eq('location_id', profile.location_id)
  }

  const { data: expiringStock } = await expiryQuery

  // 최근 판매 (최근 7일)
  let recentSalesQuery = supabase
    .from('sales')
    .select(`
      *,
      product:products(sku, name),
      location:locations(name)
    `)
    .gte('sale_date', new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0])
    .order('sale_date', { ascending: false })
    .order('created_at', { ascending: false })
    .limit(10)

  if (profile?.role === 'Branch_Manager') {
    recentSalesQuery = recentSalesQuery.eq('location_id', profile.location_id)
  }

  const { data: recentSales } = await recentSalesQuery

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold">Dashboard</h1>

      <DashboardStats
        todaySales={todaySales || []}
        stockBatches={stockBatches || []}
        userRole={profile?.role || 'HQ_Admin'}
      />

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <ExpiryWarnings expiringStock={expiringStock || []} />
        <RecentSales recentSales={recentSales || []} />
      </div>
    </div>
  )
}
```

#### 2.1.2 대시보드 통계 컴포넌트

**파일**: `components/dashboard/dashboard-stats.tsx`

```typescript
'use client'

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { DollarSign, Package, TrendingUp, AlertTriangle } from 'lucide-react'
import { formatCurrency } from '@/lib/utils'

interface DashboardStatsProps {
  todaySales: any[]
  stockBatches: any[]
  userRole: string
}

export function DashboardStats({ todaySales, stockBatches, userRole }: DashboardStatsProps) {
  // 오늘 판매액 합계 (통화별)
  const salesByCurrency = todaySales.reduce((acc, sale) => {
    const currency = sale.currency
    if (!acc[currency]) {
      acc[currency] = 0
    }
    acc[currency] += parseFloat(sale.total_amount)
    return acc
  }, {} as Record<string, number>)

  // 재고 가치 (통화별)
  const stockValueByCurrency = stockBatches.reduce((acc, batch) => {
    const currency = batch.location.currency
    const value = batch.qty_on_hand * batch.unit_cost
    if (!acc[currency]) {
      acc[currency] = 0
    }
    acc[currency] += value
    return acc
  }, {} as Record<string, number>)

  // 총 재고 수량
  const totalQty = stockBatches.reduce((sum, batch) => sum + batch.qty_on_hand, 0)

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">Today's Sales</CardTitle>
          <DollarSign className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          {Object.entries(salesByCurrency).length === 0 ? (
            <div className="text-2xl font-bold">No sales today</div>
          ) : (
            Object.entries(salesByCurrency).map(([currency, amount]) => (
              <div key={currency} className="text-2xl font-bold">
                {formatCurrency(amount, currency)}
              </div>
            ))
          )}
          <p className="text-xs text-muted-foreground">
            {todaySales.length} transactions
          </p>
        </CardContent>
      </Card>

      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">Stock Value</CardTitle>
          <Package className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          {Object.entries(stockValueByCurrency).map(([currency, value]) => (
            <div key={currency} className="text-2xl font-bold">
              {formatCurrency(value, currency)}
            </div>
          ))}
          <p className="text-xs text-muted-foreground">
            {totalQty} units in stock
          </p>
        </CardContent>
      </Card>

      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">Stock Items</CardTitle>
          <TrendingUp className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold">{stockBatches.length}</div>
          <p className="text-xs text-muted-foreground">
            Active batches
          </p>
        </CardContent>
      </Card>

      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">Sales (7 days)</CardTitle>
          <DollarSign className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold">{todaySales.length}</div>
          <p className="text-xs text-muted-foreground">
            Transactions this week
          </p>
        </CardContent>
      </Card>
    </div>
  )
}
```

#### 2.1.3 유통기한 경고 컴포넌트

**파일**: `components/dashboard/expiry-warnings.tsx`

```typescript
'use client'

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { AlertTriangle } from 'lucide-react'
import { formatDate } from '@/lib/utils'

export function ExpiryWarnings({ expiringStock }: { expiringStock: any[] }) {
  const getWarningLevel = (expiryDate: string) => {
    const today = new Date()
    const expiry = new Date(expiryDate)
    const daysUntilExpiry = Math.floor((expiry.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))

    if (daysUntilExpiry < 30) return { level: 'critical', color: 'destructive' as const }
    if (daysUntilExpiry < 90) return { level: 'warning', color: 'warning' as const }
    return { level: 'info', color: 'secondary' as const }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <AlertTriangle className="h-5 w-5" />
          Expiry Warnings (Next 3 Months)
        </CardTitle>
      </CardHeader>
      <CardContent>
        {expiringStock.length === 0 ? (
          <p className="text-gray-500">No items expiring soon</p>
        ) : (
          <div className="space-y-3">
            {expiringStock.slice(0, 5).map((item) => {
              const warning = getWarningLevel(item.expiry_date)
              return (
                <div key={item.id} className="flex items-center justify-between border-b pb-2">
                  <div>
                    <div className="font-medium">{item.product.sku}</div>
                    <div className="text-sm text-gray-500">
                      {item.location.name} - {item.batch_no}
                    </div>
                  </div>
                  <div className="text-right">
                    <Badge variant={warning.color}>{formatDate(item.expiry_date)}</Badge>
                    <div className="text-sm text-gray-500 mt-1">
                      {item.qty_on_hand} {item.product.unit}
                    </div>
                  </div>
                </div>
              )
            })}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

#### 2.1.4 최근 판매 컴포넌트

**파일**: `components/dashboard/recent-sales.tsx`

```typescript
'use client'

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { formatDate, formatCurrency } from '@/lib/utils'

export function RecentSales({ recentSales }: { recentSales: any[] }) {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Recent Sales (Last 7 Days)</CardTitle>
      </CardHeader>
      <CardContent>
        {recentSales.length === 0 ? (
          <p className="text-gray-500">No recent sales</p>
        ) : (
          <div className="space-y-3">
            {recentSales.map((sale) => (
              <div key={sale.id} className="flex items-center justify-between border-b pb-2">
                <div>
                  <div className="font-medium">{sale.product.sku}</div>
                  <div className="text-sm text-gray-500">
                    {sale.location.name} - {formatDate(sale.sale_date)}
                  </div>
                </div>
                <div className="text-right">
                  <div className="font-bold">{formatCurrency(sale.total_amount, sale.currency)}</div>
                  <div className="text-sm text-gray-500">{sale.qty} units</div>
                </div>
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

---

### 2.2 기본 리포트

#### 2.2.1 리포트 페이지

**파일**: `app/(dashboard)/reports/page.tsx`

```typescript
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import Link from 'next/link'
import { FileText, Package, TrendingUp } from 'lucide-react'

const reports = [
  {
    title: 'Sales Report',
    description: 'View daily sales by branch and product',
    icon: TrendingUp,
    href: '/reports/sales',
  },
  {
    title: 'Inventory Report',
    description: 'View current stock by location and batch',
    icon: Package,
    href: '/reports/inventory',
  },
  {
    title: 'Transaction History',
    description: 'View all purchase orders and transfers',
    icon: FileText,
    href: '/reports/transactions',
  },
]

export default function ReportsPage() {
  return (
    <div>
      <h1 className="text-3xl font-bold mb-6">Reports</h1>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {reports.map((report) => {
          const Icon = report.icon
          return (
            <Link key={report.href} href={report.href}>
              <Card className="hover:shadow-lg transition-shadow">
                <CardHeader>
                  <div className="flex items-center gap-3">
                    <Icon className="h-8 w-8 text-primary" />
                    <CardTitle>{report.title}</CardTitle>
                  </div>
                </CardHeader>
                <CardContent>
                  <CardDescription>{report.description}</CardDescription>
                </CardContent>
              </Card>
            </Link>
          )
        })}
      </div>
    </div>
  )
}
```

---

### 2.3 GitHub Actions CI/CD 설정

#### 2.3.1 GitHub Actions 워크플로우

**파일**: `.github/workflows/ci.yml`

```yaml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  lint-and-type-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run ESLint
        run: npm run lint

      - name: Run TypeScript type check
        run: npm run type-check

  build:
    runs-on: ubuntu-latest
    needs: lint-and-type-check

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}

  deploy:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'

    steps:
      - uses: actions/checkout@v3

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

#### 2.3.2 package.json 스크립트 추가

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  }
}
```

---

### 2.4 Vercel 배포

#### 2.4.1 Vercel 프로젝트 생성

1. [Vercel Dashboard](https://vercel.com/dashboard) 접속
2. "Add New Project" 클릭
3. GitHub 저장소 연결
4. 환경변수 설정:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
5. "Deploy" 클릭

#### 2.4.2 GitHub Secrets 설정

GitHub 저장소 Settings → Secrets → Actions에서 추가:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `VERCEL_TOKEN` (Vercel Account Settings에서 생성)
- `VERCEL_ORG_ID` (Vercel Project Settings에서 확인)
- `VERCEL_PROJECT_ID` (Vercel Project Settings에서 확인)

---

### 2.5 최종 통합 테스트

#### 2.5.1 전체 워크플로우 테스트 체크리스트

**1. 인증 및 권한**
- [ ] HQ Admin 로그인 정상 작동
- [ ] Branch Manager 로그인 정상 작동
- [ ] 역할별 메뉴 표시 확인
- [ ] 권한 없는 페이지 접근 차단 확인

**2. 마스터 데이터**
- [ ] 공급업체 추가/수정 정상 작동
- [ ] 제품 추가/수정 정상 작동
- [ ] 지사 조회/수정 정상 작동

**3. 구매 발주 및 입고**
- [ ] PO 생성 → 승인 → 입고 전체 프로세스
- [ ] HQ 재고 자동 증가 확인
- [ ] 배치 정보 및 유통기한 정확성

**4. 재고 이전**
- [ ] HQ → 지사 이전 정상 작동
- [ ] FIFO 로직 정상 작동 (가장 빠른 유통기한부터 차감)
- [ ] HQ 감소, 지사 증가 확인

**5. 환율 및 가격**
- [ ] 환율 입력 및 조회 정상 작동
- [ ] 가격 계산 공식 정확성
- [ ] 제품-지사별 가격 저장 확인

**6. 판매**
- [ ] 판매 입력 정상 작동
- [ ] 가격 자동 불러오기
- [ ] FIFO 재고 차감 정상 작동
- [ ] 판매 이력 조회

**7. 대시보드 및 리포트**
- [ ] 대시보드 통계 정확성
- [ ] 유통기한 경고 표시
- [ ] 기본 리포트 조회

---

## 3. 사용자 매뉴얼

**파일**: `README.md` (프로젝트 루트)

```markdown
# Arno Cosmetics Inventory & Sales Management System

## 시스템 개요

한국 본사와 베트남/중국 지사를 위한 재고 및 판매 관리 시스템

## 주요 기능

1. **구매 발주 및 입고 관리** (HQ Admin)
2. **재고 이전** (HQ → 지사)
3. **원가 기반 가격 계산**
4. **판매 입력** (Branch Manager)
5. **FIFO 재고 관리**
6. **대시보드 및 리포트**

## 사용자 역할

### HQ Admin (본사 관리자)
- 모든 기능 접근 가능
- 공급업체, 제품, 지사 관리
- 구매 발주 및 입고 처리
- 재고 이전
- 가격 설정

### Branch Manager (지사 관리자)
- 자기 지사 데이터만 접근
- 재고 조회
- 판매 입력
- 판매 이력 조회

## 빠른 시작

### 로그인
1. 시스템 접속: https://your-domain.vercel.app
2. 이메일 및 비밀번호 입력
3. 역할에 따라 대시보드 표시

### 구매 발주 (HQ Admin)
1. Purchase Orders → Create PO
2. 공급업체 선택
3. 제품 및 수량 입력
4. PO 승인
5. 입고 처리 (배치 정보 입력)

### 재고 이전 (HQ Admin)
1. Inventory → Transfer Stock
2. 목적지 지사 선택
3. 제품 및 수량 입력
4. 확인 (FIFO 자동 적용)

### 판매 입력 (Branch Manager)
1. Sales → Add Sale
2. 판매 날짜 선택
3. 제품 선택 (가격 자동 입력)
4. 수량 입력
5. 확인

## 기술 스택

- **Frontend:** Next.js 14, TypeScript, Tailwind CSS, shadcn/ui
- **Backend:** Next.js API Routes
- **Database:** Supabase (PostgreSQL)
- **Deployment:** Vercel
- **CI/CD:** GitHub Actions

## 환경 설정

`.env.local` 파일 생성:
```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

## 로컬 개발

```bash
npm install
npm run dev
```

브라우저에서 http://localhost:3000 접속

## 배포

main 브랜치에 푸시하면 자동으로 Vercel에 배포됩니다.

## 문의

문제 발생 시 GitHub Issues에 등록해주세요.
```

---

## 4. 테스트 체크리스트

### 4.1 대시보드 테스트
- [ ] 오늘 판매액 정확성
- [ ] 재고 가치 계산 정확성
- [ ] 유통기한 경고 표시 (3개월 이내)
- [ ] 최근 판매 표시

### 4.2 리포트 테스트
- [ ] 판매 리포트 조회
- [ ] 재고 리포트 조회
- [ ] 거래 이력 조회

### 4.3 배포 테스트
- [ ] Vercel 배포 성공
- [ ] 프로덕션 환경 정상 작동
- [ ] 환경변수 정상 적용
- [ ] HTTPS 인증서 확인

### 4.4 CI/CD 테스트
- [ ] GitHub Actions 워크플로우 정상 실행
- [ ] Lint 체크 통과
- [ ] Type 체크 통과
- [ ] 빌드 성공
- [ ] 자동 배포 성공

---

## 5. 산출물

### 5.1 완료된 기능
- ✅ 대시보드 (통계, 유통기한 경고, 최근 판매)
- ✅ 기본 리포트 (판매, 재고, 거래 이력)
- ✅ GitHub Actions CI/CD 설정
- ✅ Vercel 배포
- ✅ 사용자 매뉴얼 (README.md)
- ✅ 최종 통합 테스트

### 5.2 프로젝트 완료
- ✅ Phase 01~08 모든 기능 구현 완료
- ✅ MVP 요구사항 충족
- ✅ 프로덕션 배포 완료
- ✅ 문서화 완료

---

## 6. Post-MVP 개선 사항

### 단기 (1-2개월)
- Excel 대량 업로드
- 반품/환불 처리
- 상세 리포트 (P&L, 마진 분석)
- 감사 로그

### 중기 (3-6개월)
- 프로모션 및 할인 관리
- 자동 환율 업데이트 API
- 고급 가격 시뮬레이터
- 샘플 재고 관리

### 장기 (6개월 이상)
- 원료 및 인증 관리
- 바코드/QR 스캔
- 모바일 앱
- AI 수요 예측

---

## 7. 작업 이후 체크리스트

- [ ] 대시보드 정상 작동 확인
- [ ] 모든 리포트 정상 조회 확인
- [ ] Vercel 배포 성공 확인
- [ ] CI/CD 파이프라인 정상 작동 확인
- [ ] 전체 워크플로우 통합 테스트 완료
- [ ] GitHub에 최종 코드 푸시
- [ ] Worklog 문서 작성: `008.phase08.대시보드_리포트_배포.md`
- [ ] **프로젝트 완료 보고서 작성**

---

## 8. 프로젝트 완료 축하합니다!

8주간의 개발 과정을 거쳐 Arno Cosmetics MVP 시스템이 완성되었습니다.

### 달성한 목표
- ✅ 전체 재고 및 판매 관리 워크플로우 구현
- ✅ FIFO 재고 관리 시스템
- ✅ 원가 기반 가격 계산 엔진
- ✅ 역할 기반 접근 제어
- ✅ 프로덕션 배포 완료

### 다음 단계
1. 사용자 피드백 수집
2. 버그 수정 및 최적화
3. Post-MVP 기능 우선순위 결정
4. Phase 2 계획 수립

감사합니다!
