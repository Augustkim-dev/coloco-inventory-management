# Phase 01: 프로젝트 초기 설정 및 인증

**작업 기간**: 1주 (5일)
**담당자**: 개발팀
**목표**: Next.js 프로젝트 생성, Supabase 연동, 기본 인증 시스템 구현

---

## 1. 개요

Arno Cosmetics 재고 및 판매 관리 시스템의 기반이 되는 프로젝트 구조를 생성하고, 사용자 인증 시스템을 구축합니다.

### 핵심 목표
- ✅ Next.js 14+ 프로젝트 생성 (App Router, TypeScript)
- ✅ Supabase 연동 및 인증 구현
- ✅ 역할 기반 접근 제어 (RBAC) 기본 구조
- ✅ GitHub 저장소 및 CI/CD 준비

---

## 2. 기술 스택

| 항목 | 기술 | 버전 |
|------|------|------|
| 프레임워크 | Next.js | 14.x |
| 언어 | TypeScript | 5.x |
| 스타일링 | Tailwind CSS | 3.x |
| UI 컴포넌트 | shadcn/ui | latest |
| 백엔드/DB | Supabase | latest |
| 폼 관리 | React Hook Form | 7.x |
| 배포 | Vercel | - |

---

## 3. 작업 상세

### 3.1 Next.js 프로젝트 생성

**명령어**:
```bash
npx create-next-app@latest arno-inventory --typescript --tailwind --app --no-src-dir
cd arno-inventory
```

**설정 옵션**:
- ✅ TypeScript: Yes
- ✅ ESLint: Yes
- ✅ Tailwind CSS: Yes
- ✅ App Router: Yes
- ✅ `src/` directory: No
- ✅ Import alias (@/*): Yes

**폴더 구조**:
```
arno-inventory/
├── app/                    # Next.js App Router
│   ├── (auth)/            # 인증 관련 라우트
│   │   ├── login/
│   │   └── layout.tsx
│   ├── (dashboard)/       # 대시보드 라우트 (인증 필요)
│   │   ├── dashboard/
│   │   ├── suppliers/
│   │   ├── products/
│   │   └── layout.tsx
│   ├── api/               # API Routes
│   ├── layout.tsx
│   └── page.tsx
├── components/            # 재사용 컴포넌트
│   ├── ui/               # shadcn/ui 컴포넌트
│   ├── auth/             # 인증 관련 컴포넌트
│   └── layout/           # 레이아웃 컴포넌트
├── lib/                   # 유틸리티
│   ├── supabase/         # Supabase 클라이언트
│   ├── utils.ts          # 헬퍼 함수
│   └── constants.ts      # 상수
├── types/                 # TypeScript 타입
│   ├── database.ts       # Supabase 생성 타입
│   └── index.ts          # 공통 타입
├── hooks/                 # Custom React Hooks
├── docs/                  # 문서
│   ├── plans/
│   └── worklogs/
└── public/               # 정적 파일
```

---

### 3.2 shadcn/ui 설치 및 설정

**shadcn/ui 초기화**:
```bash
npx shadcn-ui@latest init
```

**설치할 컴포넌트** (Phase 01용):
```bash
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add label
npx shadcn-ui@latest add card
npx shadcn-ui@latest add form
npx shadcn-ui@latest add toast
```

---

### 3.3 Supabase 프로젝트 생성 및 연동

#### 3.3.1 Supabase 프로젝트 생성
1. [Supabase Dashboard](https://supabase.com/dashboard) 접속
2. 새 프로젝트 생성:
   - **Name**: arno-inventory
   - **Database Password**: (강력한 비밀번호 생성)
   - **Region**: Northeast Asia (Seoul)

#### 3.3.2 Supabase 클라이언트 설치
```bash
npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
```

#### 3.3.3 환경변수 설정
`.env.local` 파일 생성:
```env
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

#### 3.3.4 Supabase 클라이언트 생성

**파일**: `lib/supabase/client.ts`
```typescript
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs'
import { Database } from '@/types/database'

export const createClient = () => createClientComponentClient<Database>()
```

**파일**: `lib/supabase/server.ts`
```typescript
import { createServerComponentClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'
import { Database } from '@/types/database'

export const createServerClient = () => {
  const cookieStore = cookies()
  return createServerComponentClient<Database>({ cookies: () => cookieStore })
}
```

---

### 3.4 데이터베이스: users 테이블 확장

Supabase는 기본적으로 `auth.users` 테이블을 제공하지만, 추가 정보를 저장하기 위해 `public.users` 테이블을 생성합니다.

**SQL 마이그레이션** (`supabase/migrations/001_create_users_table.sql`):
```sql
-- public.users 테이블 생성 (auth.users 확장)
CREATE TABLE public.users (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('HQ_Admin', 'Branch_Manager')),
  location_id UUID, -- Phase 02에서 외래 키 추가
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS 활성화
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;

-- 정책: 자기 자신의 정보만 조회 가능
CREATE POLICY "Users can view own data" ON public.users
  FOR SELECT USING (auth.uid() = id);

-- 정책: HQ Admin은 모든 사용자 조회 가능
CREATE POLICY "HQ Admin can view all users" ON public.users
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM public.users
      WHERE id = auth.uid() AND role = 'HQ_Admin'
    )
  );

-- 인덱스
CREATE INDEX idx_users_role ON public.users(role);
CREATE INDEX idx_users_location_id ON public.users(location_id);

-- 업데이트 타임스탬프 자동 업데이트 트리거
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER users_updated_at
  BEFORE UPDATE ON public.users
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at();
```

---

### 3.5 인증 UI 구현

#### 3.5.1 로그인 페이지

**파일**: `app/(auth)/login/page.tsx`
```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    })

    if (error) {
      toast({
        variant: 'destructive',
        title: 'Login Failed',
        description: error.message,
      })
    } else {
      toast({
        title: 'Login Successful',
        description: 'Redirecting to dashboard...',
      })
      router.push('/dashboard')
      router.refresh()
    }

    setLoading(false)
  }

  return (
    <div className="flex min-h-screen items-center justify-center">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Arno Inventory System</CardTitle>
          <CardDescription>Login to access the system</CardDescription>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleLogin} className="space-y-4">
            <div>
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            <div>
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
            </div>
            <Button type="submit" className="w-full" disabled={loading}>
              {loading ? 'Logging in...' : 'Login'}
            </Button>
          </form>
        </CardContent>
      </Card>
    </div>
  )
}
```

#### 3.5.2 로그아웃 기능

**파일**: `components/auth/logout-button.tsx`
```typescript
'use client'

import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/button'
import { LogOut } from 'lucide-react'

export function LogoutButton() {
  const router = useRouter()
  const supabase = createClient()

  const handleLogout = async () => {
    await supabase.auth.signOut()
    router.push('/login')
    router.refresh()
  }

  return (
    <Button variant="ghost" onClick={handleLogout}>
      <LogOut className="mr-2 h-4 w-4" />
      Logout
    </Button>
  )
}
```

---

### 3.6 역할 기반 접근 제어 (RBAC)

#### 3.6.1 인증 체크 미들웨어

**파일**: `middleware.ts` (프로젝트 루트)
```typescript
import { createMiddlewareClient } from '@supabase/auth-helpers-nextjs'
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export async function middleware(req: NextRequest) {
  const res = NextResponse.next()
  const supabase = createMiddlewareClient({ req, res })

  const {
    data: { session },
  } = await supabase.auth.getSession()

  // 인증되지 않은 사용자는 로그인 페이지로 리다이렉트
  if (!session && !req.nextUrl.pathname.startsWith('/login')) {
    return NextResponse.redirect(new URL('/login', req.url))
  }

  // 인증된 사용자가 로그인 페이지 접근 시 대시보드로 리다이렉트
  if (session && req.nextUrl.pathname.startsWith('/login')) {
    return NextResponse.redirect(new URL('/dashboard', req.url))
  }

  return res
}

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],
}
```

#### 3.6.2 사용자 정보 Hook

**파일**: `hooks/use-user.ts`
```typescript
'use client'

import { useEffect, useState } from 'react'
import { createClient } from '@/lib/supabase/client'
import { User } from '@supabase/supabase-js'

interface UserProfile {
  id: string
  email: string
  name: string
  role: 'HQ_Admin' | 'Branch_Manager'
  location_id?: string
}

export function useUser() {
  const [user, setUser] = useState<User | null>(null)
  const [profile, setProfile] = useState<UserProfile | null>(null)
  const [loading, setLoading] = useState(true)
  const supabase = createClient()

  useEffect(() => {
    const fetchUser = async () => {
      const { data: { user } } = await supabase.auth.getUser()

      if (user) {
        setUser(user)

        // public.users에서 프로필 조회
        const { data: profile } = await supabase
          .from('users')
          .select('*')
          .eq('id', user.id)
          .single()

        setProfile(profile)
      }

      setLoading(false)
    }

    fetchUser()

    // 인증 상태 변경 구독
    const { data: { subscription } } = supabase.auth.onAuthStateChange(() => {
      fetchUser()
    })

    return () => subscription.unsubscribe()
  }, [])

  return { user, profile, loading, isHQAdmin: profile?.role === 'HQ_Admin' }
}
```

---

### 3.7 기본 레이아웃 구현

#### 3.7.1 대시보드 레이아웃

**파일**: `app/(dashboard)/layout.tsx`
```typescript
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { DashboardNav } from '@/components/layout/dashboard-nav'
import { LogoutButton } from '@/components/auth/logout-button'

export default async function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const supabase = createServerClient()

  const { data: { session } } = await supabase.auth.getSession()

  if (!session) {
    redirect('/login')
  }

  return (
    <div className="flex min-h-screen">
      <aside className="w-64 border-r bg-gray-50">
        <div className="p-6">
          <h1 className="text-xl font-bold">Arno Inventory</h1>
        </div>
        <DashboardNav />
        <div className="absolute bottom-4 left-4">
          <LogoutButton />
        </div>
      </aside>
      <main className="flex-1 p-8">
        {children}
      </main>
    </div>
  )
}
```

#### 3.7.2 네비게이션 컴포넌트

**파일**: `components/layout/dashboard-nav.tsx`
```typescript
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import { useUser } from '@/hooks/use-user'
import {
  LayoutDashboard,
  Package,
  Users,
  ShoppingCart,
  TrendingUp,
  Settings,
} from 'lucide-react'

const navItems = [
  { href: '/dashboard', label: 'Dashboard', icon: LayoutDashboard, roles: ['HQ_Admin', 'Branch_Manager'] },
  { href: '/suppliers', label: 'Suppliers', icon: Users, roles: ['HQ_Admin'] },
  { href: '/products', label: 'Products', icon: Package, roles: ['HQ_Admin'] },
  { href: '/purchase-orders', label: 'Purchase Orders', icon: ShoppingCart, roles: ['HQ_Admin'] },
  { href: '/inventory', label: 'Inventory', icon: Package, roles: ['HQ_Admin', 'Branch_Manager'] },
  { href: '/sales', label: 'Sales', icon: TrendingUp, roles: ['HQ_Admin', 'Branch_Manager'] },
  { href: '/settings', label: 'Settings', icon: Settings, roles: ['HQ_Admin'] },
]

export function DashboardNav() {
  const pathname = usePathname()
  const { profile } = useUser()

  const filteredItems = navItems.filter(item =>
    item.roles.includes(profile?.role || '')
  )

  return (
    <nav className="space-y-1 px-3">
      {filteredItems.map((item) => {
        const Icon = item.icon
        const isActive = pathname === item.href

        return (
          <Link
            key={item.href}
            href={item.href}
            className={cn(
              'flex items-center gap-3 rounded-lg px-3 py-2 text-sm transition-colors',
              isActive
                ? 'bg-primary text-primary-foreground'
                : 'hover:bg-gray-100'
            )}
          >
            <Icon className="h-4 w-4" />
            {item.label}
          </Link>
        )
      })}
    </nav>
  )
}
```

---

### 3.8 GitHub 저장소 설정

#### 3.8.1 .gitignore 확인
```gitignore
# dependencies
/node_modules

# next.js
/.next/
/out/

# environment variables
.env*.local

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
```

#### 3.8.2 초기 커밋
```bash
git init
git add .
git commit -m "Initial commit: Next.js project with Supabase auth"
git branch -M main
git remote add origin <your-github-repo-url>
git push -u origin main
```

---

### 3.9 Vercel 배포 준비

1. [Vercel Dashboard](https://vercel.com/dashboard) 접속
2. GitHub 저장소 연결
3. 환경변수 설정:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
4. 배포 (Phase 08에서 진행)

---

## 4. 테스트 체크리스트

### 4.1 기능 테스트
- [ ] 로그인 페이지 접근 가능
- [ ] 유효한 이메일/비밀번호로 로그인 성공
- [ ] 잘못된 인증 정보로 로그인 실패 (에러 메시지 표시)
- [ ] 로그인 후 대시보드로 리다이렉트
- [ ] 로그아웃 버튼 클릭 시 로그인 페이지로 이동
- [ ] 인증되지 않은 사용자가 대시보드 접근 시 로그인 페이지로 리다이렉트
- [ ] HQ Admin과 Branch Manager 역할에 따른 네비게이션 메뉴 표시 차이 확인

### 4.2 코드 품질
- [ ] TypeScript 타입 에러 없음 (`npm run type-check`)
- [ ] ESLint 경고 없음 (`npm run lint`)
- [ ] 빌드 성공 (`npm run build`)

---

## 5. 산출물

### 5.1 완료된 기능
- ✅ Next.js 14+ 프로젝트 생성 (App Router, TypeScript)
- ✅ Tailwind CSS + shadcn/ui 설정
- ✅ Supabase 연동
- ✅ 로그인/로그아웃 UI
- ✅ JWT 기반 인증
- ✅ 역할 기반 접근 제어 (HQ_Admin, Branch_Manager)
- ✅ 기본 대시보드 레이아웃 및 네비게이션
- ✅ GitHub 저장소 생성

### 5.2 다음 Phase 준비사항
- Phase 02에서 `locations` 테이블 생성 후 `users.location_id` 외래 키 활성화
- 테스트 계정 생성 (HQ Admin 1명, Branch Manager 2명)

---

## 6. 참고 자료

- [Next.js 14 Documentation](https://nextjs.org/docs)
- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [shadcn/ui Components](https://ui.shadcn.com/)
- [Tailwind CSS](https://tailwindcss.com/docs)

---

## 7. 작업 이후 체크리스트

- [ ] 로컬 환경에서 로그인/로그아웃 정상 작동 확인
- [ ] Supabase Dashboard에서 `public.users` 테이블 확인
- [ ] GitHub에 코드 푸시 완료
- [ ] Worklog 문서 작성: `001.phase01.프로젝트_초기_설정_및_인증.md`
- [ ] Phase 02 계획 검토
