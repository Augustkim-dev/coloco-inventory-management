# 005. Phase 04 Enhanced 2 - Location 순서 변경 기능 구현 계획

## 작업 개요

**목표:** 사용자가 Inventory Kanban View에서 표시되는 Location 순서를 자유롭게 변경할 수 있는 기능 추가

**현재 상황:**
- Kanban View에서 순서가 고정됨: Korea HQ → China → Vietnam
- 나중에 Branch 추가 시 순서 조정 어려움
- Location 추가/삭제 시 유연한 순서 관리 필요

**목표 순서:**
- Korea HQ: 1
- Vietnam Branch: 2
- China Branch: 3

---

## 추천 방식: 전용 순서 변경 페이지 (Dedicated Reorder Page)

### 선택 이유

| 기준 | 이유 |
|------|------|
| **데이터 크기** | 3-5개 locations → 단순 정수 순서로 충분 |
| **기술 스택** | 이미 @dnd-kit 사용 중 → 일관된 UX |
| **사용 빈도** | 드물게 변경 → 별도 페이지가 적합 |
| **안전성** | 실수로 순서 변경 방지 (명확한 저장 단계) |
| **접근성** | 키보드 네비게이션 + 터치 드래그 지원 |

### 비교: 다른 방식들

#### 방식 A: Kanban View에서 직접 드래그
```
Korea HQ (드래그 가능)
  ↕️
Vietnam Branch (드래그 가능)
  ↕️
China Branch (드래그 가능)
```

**장점:**
- 빠른 접근 (별도 페이지 없음)
- 즉시 변경 가능

**단점:**
- ❌ 재고 이동과 혼동 가능
- ❌ 실수로 순서 변경 위험
- ❌ UI가 복잡해짐 (두 가지 드래그 기능)

**결론:** 추천하지 않음

---

#### 방식 B: 전용 순서 변경 페이지 ✅ **추천**
```
/locations 페이지
  [Locations 목록]
  [Reorder Locations] 버튼
    ↓
/locations/reorder 페이지
  드래그 가능한 리스트
  [Save Order] / [Cancel]
```

**장점:**
- ✅ 명확한 목적 (순서 변경만)
- ✅ 안전 (저장 전까지 변경 없음)
- ✅ 재고 이동과 분리
- ✅ 깔끔한 UI
- ✅ 미리보기 가능

**단점:**
- 한 번 더 클릭 필요

**결론:** 최종 선택 ✅

---

#### 방식 C: Table View에서 ↑↓ 버튼
```
Korea HQ        [↑] [↓]
Vietnam Branch  [↑] [↓]
China Branch    [↑] [↓]
```

**장점:**
- 간단한 구현
- 접근성 우수 (버튼)

**단점:**
- 많은 클릭 필요
- 시각적으로 덜 직관적

**결론:** 보조 수단으로만 고려

---

## 데이터베이스 설계

### 새 컬럼: `display_order`

```sql
-- Type: INTEGER
-- Purpose: Location 표시 순서 저장
-- Range: 1, 2, 3, ... (1부터 시작)
```

**특징:**
- NOT NULL 제약
- Index 추가 (성능 최적화)
- 기본 정렬 기준으로 사용

---

## 구현 계획

### Phase 1: 데이터베이스 마이그레이션

**파일:** `supabase/migrations/013_add_locations_display_order.sql` (신규 생성)

```sql
-- Step 1: Add display_order column
ALTER TABLE public.locations
ADD COLUMN display_order INTEGER;

-- Step 2: Set initial values
-- Korea HQ: 1, Vietnam Branch: 2, China Branch: 3
UPDATE public.locations
SET display_order = CASE
  WHEN location_type = 'HQ' THEN 1
  WHEN name LIKE '%Vietnam%' THEN 2
  WHEN name LIKE '%China%' THEN 3
  ELSE 99  -- Fallback for future branches
END;

-- Better approach: Update by country_code
UPDATE public.locations
SET display_order = CASE
  WHEN location_type = 'HQ' THEN 1
  WHEN country_code = 'VN' THEN 2
  WHEN country_code = 'CN' THEN 3
  ELSE (
    SELECT COALESCE(MAX(display_order), 0) + 1
    FROM public.locations
    WHERE display_order < 99
  )  -- Auto-increment for new branches
END;

-- Step 3: Make it NOT NULL
ALTER TABLE public.locations
ALTER COLUMN display_order SET NOT NULL;

-- Step 4: Add index for performance
CREATE INDEX idx_locations_display_order
ON public.locations(display_order);

-- Step 5: Add comment
COMMENT ON COLUMN public.locations.display_order
IS 'Display order in UI (1=first, 2=second, etc.)';
```

**검증 쿼리:**
```sql
-- Verify order
SELECT id, name, location_type, country_code, display_order
FROM public.locations
ORDER BY display_order;

-- Expected result:
-- 1 | Korea HQ       | HQ     | KR  | 1
-- 2 | Vietnam Branch | Branch | VN  | 2
-- 3 | China Branch   | Branch | CN  | 3
```

---

### Phase 2: 타입 정의 업데이트

**파일:** `types/database.ts` (수정)

**현재:**
```typescript
locations: {
  Row: {
    id: string
    name: string
    location_type: string
    country_code: string
    address: string | null
    currency: string
    timezone: string
    created_at: string
    updated_at: string
  }
}
```

**변경 후:**
```typescript
locations: {
  Row: {
    id: string
    name: string
    location_type: string
    country_code: string
    address: string | null
    currency: string
    timezone: string
    display_order: number  // ← ADD THIS
    created_at: string
    updated_at: string
  }
  Insert: {
    // ... existing fields
    display_order?: number  // Optional on insert (will auto-calculate)
  }
  Update: {
    // ... existing fields
    display_order?: number  // Optional on update
  }
}
```

---

### Phase 3: Sortable Location Item 컴포넌트

**파일:** `components/locations/sortable-location-item.tsx` (신규 생성)

```tsx
'use client'

import { useSortable } from '@dnd-kit/sortable'
import { CSS } from '@dnd-kit/utilities'
import { GripVertical } from 'lucide-react'
import { Badge } from '@/components/ui/badge'
import { cn } from '@/lib/utils'
import { Location } from '@/types'

interface SortableLocationItemProps {
  location: Location
}

export function SortableLocationItem({ location }: SortableLocationItemProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: location.id })

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
  }

  return (
    <div
      ref={setNodeRef}
      style={style}
      className={cn(
        'flex items-center gap-4 p-4 bg-card border rounded-lg',
        'transition-all duration-200',
        isDragging && 'opacity-50 shadow-lg ring-2 ring-primary',
        'hover:shadow-md'
      )}
    >
      {/* Drag Handle */}
      <div
        {...attributes}
        {...listeners}
        className="cursor-grab active:cursor-grabbing touch-none"
      >
        <GripVertical className="h-5 w-5 text-muted-foreground" />
      </div>

      {/* Location Info */}
      <div className="flex-1">
        <div className="flex items-center gap-2 mb-1">
          <span className="font-medium text-lg">{location.name}</span>
          <Badge
            variant={location.location_type === 'HQ' ? 'default' : 'secondary'}
          >
            {location.location_type}
          </Badge>
        </div>
        <div className="flex items-center gap-3 text-sm text-muted-foreground">
          <span>🌍 {location.country_code}</span>
          <span>💰 {location.currency}</span>
          {location.address && <span>📍 {location.address}</span>}
        </div>
      </div>

      {/* Order Number (visual indicator) */}
      <div className="text-2xl font-bold text-muted-foreground/30">
        {location.display_order}
      </div>
    </div>
  )
}
```

---

### Phase 4: Reorder 페이지 생성

**파일:** `app/(dashboard)/locations/reorder/page.tsx` (신규 생성)

```tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { LocationsReorderClient } from '@/components/locations/locations-reorder-client'

export default async function LocationsReorderPage() {
  const supabase = await createClient()

  // Check authentication
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  // Get user profile
  const { data: profile } = await supabase
    .from('users')
    .select('role')
    .eq('id', user.id)
    .single()

  // Only HQ Admin can reorder locations
  if (profile?.role !== 'HQ_Admin') {
    redirect('/locations')
  }

  // Fetch locations ordered by display_order
  const { data: locations, error } = await supabase
    .from('locations')
    .select('*')
    .order('display_order', { ascending: true })

  if (error) {
    console.error('Error loading locations:', error)
    return (
      <div className="flex items-center justify-center h-96">
        <p className="text-destructive">Error loading locations</p>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold">Reorder Locations</h1>
        <p className="text-muted-foreground mt-1">
          Drag and drop to change the display order of locations
        </p>
      </div>

      <LocationsReorderClient initialLocations={locations || []} />
    </div>
  )
}
```

---

### Phase 5: Reorder Client 컴포넌트

**파일:** `components/locations/locations-reorder-client.tsx` (신규 생성)

```tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragEndEvent,
} from '@dnd-kit/core'
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from '@dnd-kit/sortable'
import { Button } from '@/components/ui/button'
import { SortableLocationItem } from './sortable-location-item'
import { createClient } from '@/lib/supabase/client'
import { toast } from 'sonner'
import { ArrowLeft, Save } from 'lucide-react'
import { Location } from '@/types'

interface LocationsReorderClientProps {
  initialLocations: Location[]
}

export function LocationsReorderClient({
  initialLocations,
}: LocationsReorderClientProps) {
  const [locations, setLocations] = useState(initialLocations)
  const [hasChanges, setHasChanges] = useState(false)
  const [isSaving, setIsSaving] = useState(false)
  const router = useRouter()
  const supabase = createClient()

  // Setup sensors for drag and drop
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  )

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event

    if (!over || active.id === over.id) {
      return
    }

    setLocations((items) => {
      const oldIndex = items.findIndex((item) => item.id === active.id)
      const newIndex = items.findIndex((item) => item.id === over.id)

      const newItems = arrayMove(items, oldIndex, newIndex)
      setHasChanges(true)
      return newItems
    })
  }

  const handleSave = async () => {
    setIsSaving(true)

    try {
      // Update display_order for all locations
      const updates = locations.map((location, index) => ({
        id: location.id,
        display_order: index + 1, // 1-based indexing
      }))

      // Execute all updates
      const { error } = await supabase
        .from('locations')
        .upsert(
          updates.map((u) => ({
            id: u.id,
            display_order: u.display_order,
          }))
        )

      if (error) {
        throw error
      }

      toast.success('Location order saved successfully')
      router.push('/locations')
      router.refresh()
    } catch (error) {
      console.error('Error saving order:', error)
      toast.error('Failed to save location order')
    } finally {
      setIsSaving(false)
    }
  }

  const handleCancel = () => {
    if (hasChanges) {
      const confirm = window.confirm(
        'You have unsaved changes. Are you sure you want to cancel?'
      )
      if (!confirm) return
    }
    router.push('/locations')
  }

  return (
    <div className="space-y-6">
      {/* Info Banner */}
      <div className="bg-accent/50 border border-accent rounded-lg p-4">
        <p className="text-sm">
          💡 <strong>Tip:</strong> Drag the grip handle (⋮⋮) to reorder
          locations. This order will be used in the Inventory Kanban View.
        </p>
      </div>

      {/* Sortable List */}
      <DndContext
        sensors={sensors}
        collisionDetection={closestCenter}
        onDragEnd={handleDragEnd}
      >
        <SortableContext
          items={locations}
          strategy={verticalListSortingStrategy}
        >
          <div className="space-y-2">
            {locations.map((location) => (
              <SortableLocationItem key={location.id} location={location} />
            ))}
          </div>
        </SortableContext>
      </DndContext>

      {/* Action Buttons */}
      <div className="flex items-center justify-between pt-4 border-t">
        <Button variant="outline" onClick={handleCancel}>
          <ArrowLeft className="mr-2 h-4 w-4" />
          Cancel
        </Button>

        <Button onClick={handleSave} disabled={!hasChanges || isSaving}>
          <Save className="mr-2 h-4 w-4" />
          {isSaving ? 'Saving...' : 'Save Order'}
        </Button>
      </div>

      {/* Change Indicator */}
      {hasChanges && (
        <div className="text-sm text-muted-foreground text-center">
          ⚠️ You have unsaved changes
        </div>
      )}
    </div>
  )
}
```

---

### Phase 6: Locations 페이지에 Reorder 버튼 추가

**파일:** `app/(dashboard)/locations/page.tsx` (수정)

**변경 전:**
```typescript
const { data: locations } = await supabase
  .from('locations')
  .select('*')
  .order('location_type', { ascending: false })
```

**변경 후:**
```typescript
const { data: locations } = await supabase
  .from('locations')
  .select('*')
  .order('display_order', { ascending: true })  // ← CHANGED
```

**UI 변경:**
```tsx
<div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
  <div>
    <h1 className="text-3xl font-bold">Locations</h1>
    <p className="text-muted-foreground mt-1">
      Manage your warehouse and branch locations
    </p>
  </div>

  {/* Action Buttons */}
  <div className="flex gap-2">
    {userData?.role === 'HQ_Admin' && (
      <>
        {/* Reorder Button - NEW */}
        <Link href="/locations/reorder">
          <Button variant="outline">
            <GripVertical className="mr-2 h-4 w-4" />
            Reorder
          </Button>
        </Link>

        {/* Existing Add Button */}
        <Link href="/locations/new">
          <Button>
            <Plus className="mr-2 h-4 w-4" />
            Add Location
          </Button>
        </Link>
      </>
    )}
  </div>
</div>
```

---

### Phase 7: Inventory 페이지 정렬 업데이트

**파일:** `app/(dashboard)/inventory/page.tsx` (수정)

**변경 전:**
```typescript
// Get all locations for Kanban view
const { data: locations } = await supabase
  .from('locations')
  .select('*')
  .order('location_type', { ascending: false }) // HQ first, then Branches
```

**변경 후:**
```typescript
// Get all locations for Kanban view (ordered by display_order)
const { data: locations } = await supabase
  .from('locations')
  .select('*')
  .order('display_order', { ascending: true })  // ← CHANGED
```

---

### Phase 8: 새 Location 추가 시 자동 순서 할당

**파일:** `app/(dashboard)/locations/new/page.tsx` 또는 API (필요 시 수정)

```typescript
// When creating a new location, auto-assign display_order
const { data: maxOrder } = await supabase
  .from('locations')
  .select('display_order')
  .order('display_order', { ascending: false })
  .limit(1)
  .single()

const newDisplayOrder = (maxOrder?.display_order || 0) + 1

await supabase.from('locations').insert({
  name: 'New Branch',
  // ... other fields
  display_order: newDisplayOrder,  // Auto-assign to end
})
```

---

## 사용자 시나리오

### 시나리오 1: 순서 변경

**목표:** Vietnam을 맨 아래로 이동

1. `/locations` 페이지 접속
2. **[Reorder]** 버튼 클릭
3. `/locations/reorder` 페이지로 이동
4. 현재 순서:
   ```
   1. Korea HQ
   2. Vietnam Branch  ← 드래그
   3. China Branch
   ```
5. Vietnam을 아래로 드래그
6. 새 순서:
   ```
   1. Korea HQ
   2. China Branch
   3. Vietnam Branch  ← 이동됨
   ```
7. **[Save Order]** 클릭
8. Success toast 표시
9. `/locations`로 리디렉트

### 시나리오 2: Inventory Kanban View에서 확인

1. `/inventory` 접속
2. **[Kanban View]** 클릭
3. 새 순서로 표시 확인:
   ```
   🔽 Korea HQ
   ▶ China Branch      ← 순서 변경됨
   ▶ Vietnam Branch
   ```

### 시나리오 3: 변경 취소

1. `/locations/reorder` 페이지에서 순서 변경
2. **[Cancel]** 클릭
3. 확인 다이얼로그: "You have unsaved changes..."
4. **[OK]** → `/locations`로 돌아감, 변경사항 없음

### 시나리오 4: 새 Branch 추가

1. `/locations/new` 페이지에서 "Thailand Branch" 추가
2. `display_order` 자동 할당: 4
3. Kanban View에서 맨 아래에 표시:
   ```
   1. Korea HQ
   2. Vietnam Branch
   3. China Branch
   4. Thailand Branch  ← 자동으로 맨 아래 추가
   ```
4. 필요 시 `/locations/reorder`에서 순서 조정

---

## UI/UX 특징

### 1. 시각적 피드백

| 상태 | 효과 |
|------|------|
| 기본 | 흰색 배경, 그림자 없음 |
| Hover | `hover:shadow-md` (그림자 추가) |
| 드래그 시작 | 투명도 50%, `ring-2 ring-primary` |
| 드래그 중 | 원본 위치에서 떠있는 효과 |
| 드롭 완료 | 부드러운 애니메이션으로 새 위치 이동 |

### 2. Drag Handle

```
⋮⋮  ← GripVertical 아이콘
```

- 클릭하고 드래그
- `cursor-grab` → `cursor-grabbing`
- 터치 디바이스에서도 작동 (`touch-none`)

### 3. 순서 번호 표시

```
┌─────────────────────────────────┐
│ ⋮⋮  Korea HQ  [HQ]          1   │
└─────────────────────────────────┘
```

- 우측에 큰 숫자로 현재 순서 표시
- `display_order` 값과 일치
- 반투명 (`text-muted-foreground/30`)

### 4. 접근성 (Accessibility)

**키보드 네비게이션:**
- `Tab`: 다음 항목으로 포커스
- `Space`: 드래그 활성화
- `Arrow Up/Down`: 위/아래로 이동
- `Space`: 드롭
- `Escape`: 취소

**Screen Reader:**
- @dnd-kit 자동 알림: "Korea HQ moved to position 2"
- ARIA labels: "Drag handle for Korea HQ"

---

## 데이터 흐름

```
1. User visits /locations/reorder
   ↓
2. Server fetches locations ORDER BY display_order
   ↓
3. Pass to LocationsReorderClient (Client Component)
   ↓
4. User drags location
   ↓
5. handleDragEnd → arrayMove → setLocations (local state)
   ↓
6. hasChanges = true
   ↓
7. User clicks [Save Order]
   ↓
8. Update all locations' display_order in database
   ↓
9. Toast success → redirect to /locations
   ↓
10. Inventory Kanban View uses new order
```

---

## 에러 처리

### 1. 권한 체크

```typescript
if (profile?.role !== 'HQ_Admin') {
  redirect('/locations')
}
```

- Branch Manager는 접근 불가
- 자동으로 `/locations`로 리디렉트

### 2. 저장 실패

```typescript
try {
  await supabase.from('locations').upsert(...)
} catch (error) {
  toast.error('Failed to save location order')
  // 사용자에게 재시도 기회 제공
}
```

### 3. 변경사항 확인

```typescript
const handleCancel = () => {
  if (hasChanges) {
    const confirm = window.confirm('You have unsaved changes...')
    if (!confirm) return
  }
  router.push('/locations')
}
```

---

## 성능 최적화

### 1. Index 추가

```sql
CREATE INDEX idx_locations_display_order
ON public.locations(display_order);
```

- `ORDER BY display_order` 쿼리 최적화
- 3-5개 레코드에서는 영향 미미하지만 미래 확장성 고려

### 2. Optimistic UI (미래 개선)

현재는 Save 후 새로고침, 나중에 개선 가능:

```typescript
// 저장 전에 UI 먼저 업데이트
setLocations(newOrder)

// 백그라운드에서 DB 업데이트
await updateDatabase()

// 실패 시 롤백
if (error) {
  setLocations(oldOrder)
}
```

---

## 테스트 시나리오

### 1. 정상 시나리오

| # | 작업 | 기대 결과 |
|---|------|-----------|
| 1 | HQ Admin으로 로그인 | 성공 |
| 2 | `/locations` 접속 | Reorder 버튼 표시 |
| 3 | Reorder 버튼 클릭 | `/locations/reorder`로 이동 |
| 4 | 순서: HQ, VN, CN 확인 | ✅ |
| 5 | VN을 맨 아래로 드래그 | 순서 변경: HQ, CN, VN |
| 6 | Save Order 클릭 | Success toast |
| 7 | `/locations`로 리디렉트 | ✅ |
| 8 | `/inventory` → Kanban View | 새 순서 반영 확인 |

### 2. 권한 테스트

| # | 작업 | 기대 결과 |
|---|------|-----------|
| 1 | Branch Manager 로그인 | 성공 |
| 2 | `/locations` 접속 | Reorder 버튼 숨김 |
| 3 | 직접 `/locations/reorder` 접속 | `/locations`로 리디렉트 |

### 3. 변경 취소 테스트

| # | 작업 | 기대 결과 |
|---|------|-----------|
| 1 | Reorder 페이지에서 순서 변경 | hasChanges = true |
| 2 | Cancel 버튼 클릭 | 확인 다이얼로그 표시 |
| 3 | Cancel 선택 | 변경사항 유지 (페이지 유지) |
| 4 | OK 선택 | `/locations`로 이동, 변경 없음 |

### 4. 키보드 네비게이션

| # | 작업 | 기대 결과 |
|---|------|-----------|
| 1 | Tab 키로 첫 번째 항목 포커스 | 포커스 표시 |
| 2 | Space 키 누름 | 드래그 활성화 |
| 3 | Arrow Down 키 | 아래로 이동 |
| 4 | Space 키 | 드롭 완료 |
| 5 | 순서 변경 확인 | ✅ |

---

## 마이그레이션 전략

### 1. 기존 데이터 보존

- 현재 locations 테이블의 모든 데이터 유지
- `display_order` 컬럼만 추가
- 초기값 자동 할당

### 2. 롤백 계획

```sql
-- Rollback: Remove display_order column
DROP INDEX IF EXISTS idx_locations_display_order;
ALTER TABLE public.locations DROP COLUMN IF EXISTS display_order;
```

### 3. 테스트 환경 우선

1. Development 환경에서 마이그레이션 실행
2. 테스트 후 문제 없으면 Production 적용
3. 백업 생성 후 진행

---

## 향후 개선 방향

### Phase 2 개선사항

1. **드래그 프리뷰 개선**
   - 드래그 중 반투명 카드 표시
   - 삽입 위치 시각적 표시 (파란색 선)

2. **실시간 동기화**
   - Supabase Realtime
   - 다른 HQ Admin이 변경 시 자동 반영

3. **모바일 최적화**
   - 터치 드래그 개선
   - 햅틱 피드백
   - 더 큰 터치 영역

4. **히스토리 추적**
   - 순서 변경 이력 저장
   - Audit log에 기록
   - Undo/Redo 기능

5. **드래그 애니메이션**
   - Smooth transitions
   - Spring physics
   - Visual polish

---

## 예상 작업 시간

| Phase | 작업 내용 | 예상 시간 |
|-------|----------|-----------|
| 1 | DB 마이그레이션 작성 및 실행 | 30분 |
| 2 | 타입 정의 업데이트 | 30분 |
| 3 | SortableLocationItem 컴포넌트 | 1시간 |
| 4 | Reorder 페이지 (Server) | 1시간 |
| 5 | Reorder Client 컴포넌트 | 2시간 |
| 6 | Locations 페이지 수정 | 30분 |
| 7 | Inventory 페이지 수정 | 30분 |
| 8 | 새 Location 추가 로직 | 30분 |
| 9 | 테스트 (수동 + 시나리오) | 2시간 |
| 10 | 버그 수정 및 UX 개선 | 1시간 |

**총 예상 시간:** 약 9-10시간 (1.5 작업일)

---

## 파일 요약

### 생성할 파일 (3개)

1. `supabase/migrations/013_add_locations_display_order.sql`
   - DB 스키마 변경
   - 초기값 설정: HQ=1, VN=2, CN=3

2. `app/(dashboard)/locations/reorder/page.tsx`
   - Server Component
   - 권한 체크 및 데이터 페칭

3. `components/locations/locations-reorder-client.tsx`
   - Client Component
   - 드래그 앤 드롭 로직

4. `components/locations/sortable-location-item.tsx`
   - 드래그 가능한 Location 카드

### 수정할 파일 (3개)

1. `types/database.ts`
   - `display_order: number` 추가

2. `app/(dashboard)/locations/page.tsx`
   - Reorder 버튼 추가
   - `.order('display_order')` 변경

3. `app/(dashboard)/inventory/page.tsx`
   - `.order('display_order')` 변경

---

## 결론

### ✅ 장점

1. **사용자 친화적**: 직관적인 드래그 앤 드롭
2. **안전**: 명확한 저장 단계, 실수 방지
3. **확장 가능**: 새 Branch 추가 시 쉽게 순서 조정
4. **일관성**: 기존 inventory 드래그와 동일한 UX
5. **접근성**: 키보드 네비게이션 지원
6. **성능**: Index 최적화
7. **유지보수**: 단순한 정수 순서, 이해하기 쉬움

### 📊 기술 스택 일관성

- ✅ @dnd-kit 재사용 (이미 설치됨)
- ✅ shadcn/ui 컴포넌트 사용
- ✅ Supabase 쿼리 패턴 동일
- ✅ Next.js Server/Client Component 분리

### 🎯 비즈니스 가치

- Branch 추가/삭제 시 유연한 관리
- 사용자 선호에 따른 순서 커스터마이징
- 향후 확장성 확보 (10개 이상 Branch도 대응 가능)

---

## 다음 단계

1. ✅ 계획 검토 및 승인
2. DB 마이그레이션 실행
3. 컴포넌트 구현
4. 테스트
5. 배포

**준비 완료! 승인 시 바로 구현 시작하겠습니다.** 🚀
