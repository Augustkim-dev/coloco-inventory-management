# 027. Phase 19: 설정 페이지 구현 계획

## 개요

설정 페이지는 사용자 계정 관리와 시스템 설정을 통합 관리하는 페이지입니다.
역할(Role)에 따라 다른 기능이 제공됩니다.

## 페이지 구조

```
/settings
├── 탭 1: 내 계정 (My Account) - 모든 사용자
├── 탭 2: 사용자 관리 (User Management) - HQ_Admin 전용
└── 탭 3: 시스템 설정 (System Settings) - HQ_Admin 전용
```

---

## 탭 1: 내 계정 (My Account)

**대상:** 모든 로그인 사용자

### 1.1 프로필 정보 수정
| 필드 | 설명 | 편집 가능 |
|------|------|----------|
| 이름 | 표시 이름 | O |
| 이메일 | 로그인 이메일 | X (읽기 전용) |
| 역할 | HQ_Admin / Branch_Manager | X (읽기 전용) |
| 소속 지점 | 할당된 Location | X (읽기 전용) |
| 언어 설정 | 선호 언어 (en/ko/vi/zh) | O |

### 1.2 비밀번호 변경
- 현재 비밀번호 입력
- 새 비밀번호 입력
- 새 비밀번호 확인
- Supabase Auth API 사용: `supabase.auth.updateUser({ password })`

### 1.3 로그아웃
- 현재 세션 로그아웃 버튼

---

## 탭 2: 사용자 관리 (User Management)

**대상:** HQ_Admin 전용

### 2.1 사용자 목록
| 컬럼 | 설명 |
|------|------|
| 이름 | 사용자 이름 |
| 이메일 | 로그인 이메일 |
| 역할 | HQ_Admin / Branch_Manager / SubBranch_Manager |
| 소속 지점 | 할당된 Location |
| 상태 | 활성/비활성 |
| 생성일 | 계정 생성 날짜 |
| 액션 | 편집 / 비활성화 |

### 2.2 사용자 편집 기능
- 이름 변경
- 역할 변경 (HQ_Admin / Branch_Manager / SubBranch_Manager)
- 소속 지점 변경 (Location 선택)
- 계정 활성화/비활성화 토글

### 2.3 새 사용자 초대 (향후)
- 이메일 기반 초대 기능 (Post-MVP)
- 현재는 Supabase Dashboard에서 직접 생성

---

## 탭 3: 시스템 설정 (System Settings)

**대상:** HQ_Admin 전용

### 3.1 기본 설정
| 설정 항목 | 설명 | 기본값 |
|----------|------|--------|
| 기본 통화 | HQ 기준 통화 | KRW |
| 날짜 형식 | 표시 형식 | YYYY-MM-DD |
| 만료 알림 기준 | 유통기한 알림 일수 | 30/90/180일 |

### 3.2 재고 설정
| 설정 항목 | 설명 |
|----------|------|
| 저재고 알림 기준 | 최소 재고량 기본값 |
| FIFO 엄격 모드 | FIFO 강제 적용 여부 |

### 3.3 가격 설정
| 설정 항목 | 설명 |
|----------|------|
| 기본 HQ 마진 | 기본 HQ 마진율 % |
| 기본 Branch 마진 | 기본 지점 마진율 % |
| 반올림 단위 | 가격 반올림 기준 (10, 100, 1000) |

---

## 구현 우선순위

### Phase 19-1 (MVP 필수)
1. 내 계정 - 프로필 정보 표시
2. 내 계정 - 비밀번호 변경
3. 사용자 관리 - 목록 보기

### Phase 19-2 (MVP 권장)
4. 사용자 관리 - 편집 기능
5. 사용자 관리 - 상태 변경

### Phase 19-3 (Post-MVP)
6. 시스템 설정 - 모든 설정 항목
7. 새 사용자 초대 기능

---

## 기술 구현

### 디렉토리 구조
```
app/(dashboard)/settings/
├── page.tsx                 # 메인 설정 페이지 (탭 컨테이너)
└── loading.tsx              # 로딩 상태

components/settings/
├── settings-tabs.tsx        # 탭 네비게이션
├── my-account-tab.tsx       # 내 계정 탭
├── profile-form.tsx         # 프로필 수정 폼
├── password-form.tsx        # 비밀번호 변경 폼
├── user-management-tab.tsx  # 사용자 관리 탭
├── users-list.tsx           # 사용자 목록
├── user-edit-dialog.tsx     # 사용자 편집 다이얼로그
└── system-settings-tab.tsx  # 시스템 설정 탭 (향후)
```

### 사용 컴포넌트 (shadcn/ui)
- `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent`
- `Card`, `CardHeader`, `CardContent`
- `Input`, `Label`, `Button`
- `Table` 관련 컴포넌트
- `Dialog` (편집용)
- `Switch` (상태 토글)
- `Select` (역할/지점 선택)

### API 엔드포인트
```
# 내 계정
GET  /api/users/me              # 현재 사용자 정보
PUT  /api/users/me              # 프로필 수정
POST /api/auth/change-password  # 비밀번호 변경

# 사용자 관리 (Admin)
GET  /api/users                 # 전체 사용자 목록
PUT  /api/users/:id             # 사용자 정보 수정
PUT  /api/users/:id/status      # 상태 변경

# 시스템 설정 (향후)
GET  /api/settings              # 시스템 설정 조회
PUT  /api/settings              # 시스템 설정 수정
```

### 네비게이션 접근 권한 변경
현재 Settings는 HQ_Admin 전용으로 설정되어 있으나,
내 계정 탭은 모든 사용자가 접근할 수 있어야 함.

```typescript
// lib/constants.ts 수정
{
  title: "Settings",
  href: "/settings",
  icon: Settings,
  roles: ["HQ_Admin", "Branch_Manager", "SubBranch_Manager"], // 모든 역할
}
```

---

## UI 와이어프레임

### 내 계정 탭
```
┌─────────────────────────────────────────────────┐
│ Settings                                         │
├─────────────────────────────────────────────────┤
│ [내 계정] [사용자 관리] [시스템 설정]             │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 프로필 정보                                  │ │
│ │                                              │ │
│ │ 이름: [John Kim        ] [저장]              │ │
│ │ 이메일: john@arno.com (읽기 전용)            │ │
│ │ 역할: HQ_Admin                               │ │
│ │ 소속: Korea HQ                               │ │
│ │ 언어: [한국어 ▼]        [저장]               │ │
│ └─────────────────────────────────────────────┘ │
│                                                  │
│ ┌─────────────────────────────────────────────┐ │
│ │ 비밀번호 변경                                │ │
│ │                                              │ │
│ │ 현재 비밀번호: [••••••••    ]                │ │
│ │ 새 비밀번호:   [••••••••    ]                │ │
│ │ 비밀번호 확인: [••••••••    ]                │ │
│ │                          [비밀번호 변경]      │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### 사용자 관리 탭 (Admin 전용)
```
┌─────────────────────────────────────────────────┐
│ [내 계정] [사용자 관리] [시스템 설정]            │
├─────────────────────────────────────────────────┤
│ 사용자 목록                                      │
│ ┌───────────────────────────────────────────────┐
│ │ 이름     │ 이메일          │ 역할    │ 상태 │ │
│ ├──────────┼────────────────┼────────┼──────┼──┤
│ │ John Kim │ john@arno.com  │ Admin  │ 활성 │ ⋮│
│ │ VN Mgr   │ vn@arno.com    │ Branch │ 활성 │ ⋮│
│ │ CN Mgr   │ cn@arno.com    │ Branch │ 비활성│ ⋮│
│ └───────────────────────────────────────────────┘
│                                                  │
│ ⋮ 클릭 시 → [편집] [비활성화/활성화]             │
└─────────────────────────────────────────────────┘
```

---

## 보안 고려사항

1. **비밀번호 변경**
   - 현재 비밀번호 검증 필수
   - 최소 8자 이상 요구
   - Supabase Auth 사용

2. **사용자 관리 권한**
   - HQ_Admin만 접근 가능
   - 자기 자신 비활성화 불가
   - 마지막 Admin 계정 비활성화 불가

3. **데이터 검증**
   - 서버 사이드 역할 검증
   - Location 유효성 검증

---

## 예상 작업량

| 항목 | 예상 시간 |
|------|----------|
| 페이지 구조 및 탭 | 2시간 |
| 내 계정 탭 | 3시간 |
| 비밀번호 변경 | 2시간 |
| 사용자 목록 | 2시간 |
| 사용자 편집 | 3시간 |
| 테스트 및 버그 수정 | 2시간 |
| **총계** | **14시간** |

---

## 다음 단계

1. 사용자 승인 후 구현 시작
2. Phase 19-1 (MVP 필수) 먼저 구현
3. 테스트 후 Phase 19-2 진행
